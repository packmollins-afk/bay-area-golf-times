<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bay Area Golf Tee Times</title>
  <style>
    :root {
      --primary: #2d5a27;
      --primary-light: #4a8c3f;
      --bg: #f5f7f5;
      --card-bg: #ffffff;
      --text: #1a1a1a;
      --text-muted: #666;
      --border: #e0e0e0;
      --success: #2d5a27;
      --deal: #c9302c;
      --gold: #f5a623;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

    header {
      background: var(--primary);
      color: white;
      padding: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    header h1 { font-size: 1.8rem; font-weight: 600; }
    header p { opacity: 0.9; margin-top: 4px; }

    .quick-actions {
      background: var(--card-bg);
      padding: 16px 20px;
      border-radius: 12px;
      margin: 20px 0 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .quick-actions-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .next-available-btn {
      padding: 12px 24px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .next-available-btn:hover { background: var(--primary-light); }
    .next-available-btn.active { background: #1a3d17; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }

    .region-chips { display: flex; gap: 8px; flex-wrap: wrap; }
    .region-chip {
      padding: 8px 16px;
      background: #f0f0f0;
      border: 2px solid transparent;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .region-chip:hover { background: #e8f5e9; border-color: var(--primary); }
    .region-chip.active { background: var(--primary); color: white; border-color: var(--primary); }
    .region-chip.favorites { background: #fff0f0; border-color: #e91e63; color: #e91e63; }
    .region-chip.favorites:hover { background: #fce4ec; }
    .region-chip.favorites.active { background: #e91e63; color: white; }

    /* Tab Navigation */
    .tab-nav {
      display: flex;
      gap: 0;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 4px;
      margin: 20px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .tab-btn {
      flex: 1;
      padding: 12px 24px;
      border: none;
      background: transparent;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .tab-btn:hover { background: var(--bg); }
    .tab-btn.active { background: var(--primary); color: white; }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Courses Directory */
    .courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
    }
    .course-card {
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }
    .course-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.12); }
    .course-card-img {
      height: 160px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      position: relative;
      overflow: hidden;
    }
    .course-card-img img { width: 100%; height: 100%; object-fit: cover; }
    .course-card-body { padding: 16px; }
    .course-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
    .course-card-header h3 { font-size: 1.1rem; font-weight: 600; color: var(--text); margin: 0; }
    .course-card .location { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }
    .course-card .course-meta { display: flex; gap: 12px; flex-wrap: wrap; }
    .course-card .meta-item { font-size: 0.8rem; color: var(--text-muted); display: flex; align-items: center; gap: 4px; }
    .course-card .meta-item strong { color: var(--text); }
    .course-card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); }
    .course-card .tee-times-count { font-size: 0.85rem; color: var(--primary); font-weight: 600; }
    .course-card .rating-display { display: flex; align-items: center; gap: 4px; color: var(--gold); font-weight: 600; }

    /* Favorite Button */
    .fav-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: rgba(0,0,0,0.05);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    .fav-btn:hover { background: #fce4ec; }
    .fav-btn svg { transition: all 0.2s; }
    .fav-btn.favorited { background: #fce4ec; }
    .fav-btn.favorited svg { fill: #e91e63; stroke: #e91e63; }

    .modal-fav-btn {
      position: absolute;
      top: 16px;
      left: 16px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      background: rgba(255,255,255,0.9);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .modal-fav-btn:hover { background: white; transform: scale(1.1); }
    .modal-fav-btn.favorited svg { fill: #e91e63; stroke: #e91e63; }

    .filters {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 16px;
      align-items: end;
    }
    .filter-group { display: flex; flex-direction: column; gap: 6px; }
    .filter-group label { font-size: 0.85rem; font-weight: 500; color: var(--text-muted); }
    .filter-group select, .filter-group input {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.95rem;
      background: white;
      cursor: pointer;
    }
    .filter-group select:focus, .filter-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(45, 90, 39, 0.1);
    }
    .filter-group input:disabled { background: #f5f5f5; cursor: not-allowed; }

    .btn {
      padding: 10px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover { background: var(--primary-light); }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .results-count { font-size: 0.95rem; color: var(--text-muted); }
    .sort-controls { display: flex; gap: 8px; align-items: center; }
    .sort-controls select { padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 0.9rem; }

    .tee-times-grid { display: grid; gap: 12px; }
    .tee-time-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      display: grid;
      grid-template-columns: 100px 1fr auto auto;
      gap: 20px;
      align-items: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .tee-time-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

    .time-block { text-align: center; }
    .time-block .time { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
    .time-block .date { font-size: 0.8rem; color: var(--text-muted); }

    .course-info h3 { font-size: 1.05rem; font-weight: 600; margin-bottom: 4px; }
    .course-info h3 a { color: var(--primary); text-decoration: none; cursor: pointer; }
    .course-info h3 a:hover { text-decoration: underline; }
    .course-info .location { font-size: 0.85rem; color: var(--text-muted); }
    .course-info .badges { display: flex; gap: 6px; margin-top: 6px; flex-wrap: wrap; }
    .badge { font-size: 0.75rem; padding: 3px 8px; border-radius: 4px; background: #e8f5e9; color: var(--primary); }
    .badge.holes { background: #e3f2fd; color: #1565c0; }
    .badge.players { background: #fff3e0; color: #e65100; }
    .badge.rating { background: #fff8e1; color: #f57c00; display: flex; align-items: center; gap: 3px; }

    .price-block { text-align: right; }
    .price-block .price { font-size: 1.4rem; font-weight: 700; color: var(--text); }
    .price-block .original-price { font-size: 0.85rem; color: var(--text-muted); text-decoration: line-through; }
    .price-block .deal-tag { font-size: 0.75rem; color: var(--deal); font-weight: 600; }

    .book-btn {
      padding: 12px 24px;
      background: var(--primary);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition: background 0.2s;
      white-space: nowrap;
    }
    .book-btn:hover { background: var(--primary-light); }

    .loading { text-align: center; padding: 60px 20px; color: var(--text-muted); }
    .loading-spinner {
      width: 40px; height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .no-results { text-align: center; padding: 60px 20px; background: var(--card-bg); border-radius: 12px; }
    .no-results h3 { margin-bottom: 8px; }
    .no-results p { color: var(--text-muted); }

    footer { text-align: center; padding: 40px 20px; color: var(--text-muted); font-size: 0.9rem; }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }
    .modal-overlay.active { display: flex; justify-content: center; align-items: flex-start; }
    .modal {
      background: var(--card-bg);
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      margin: 40px auto;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .modal-header {
      position: relative;
      height: 250px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      overflow: hidden;
    }
    .modal-header img { width: 100%; height: 100%; object-fit: cover; }
    .modal-header-overlay {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      padding: 30px 24px 20px;
      background: linear-gradient(transparent, rgba(0,0,0,0.7));
      color: white;
    }
    .modal-header-overlay h2 { font-size: 1.8rem; margin-bottom: 4px; }
    .modal-header-overlay .subtitle { opacity: 0.9; }
    .modal-close {
      position: absolute;
      top: 16px; right: 16px;
      width: 36px; height: 36px;
      border-radius: 50%;
      background: rgba(0,0,0,0.4);
      color: white;
      border: none;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-close:hover { background: rgba(0,0,0,0.6); }

    .modal-body { padding: 24px; }
    .modal-section { margin-bottom: 28px; }
    .modal-section:last-child { margin-bottom: 0; }
    .modal-section h3 {
      font-size: 1.1rem;
      margin-bottom: 12px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .course-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
    }
    .course-stat {
      background: var(--bg);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }
    .course-stat .value { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
    .course-stat .label { font-size: 0.75rem; color: var(--text-muted); }

    .course-record {
      background: linear-gradient(135deg, #fff8e1, #fff3e0);
      padding: 16px;
      border-radius: 10px;
      border-left: 4px solid var(--gold);
    }
    .course-record .score { font-size: 2rem; font-weight: 800; color: var(--gold); }
    .course-record .holder { font-weight: 600; margin-top: 4px; }
    .course-record .details { font-size: 0.85rem; color: var(--text-muted); margin-top: 4px; }

    .photos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
    }
    .photo-card {
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }
    .photo-card img { width: 100%; height: 100px; object-fit: cover; }
    .photo-card .year {
      position: absolute;
      bottom: 4px; right: 4px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.7rem;
    }

    .food-highlight {
      display: flex;
      gap: 16px;
      background: var(--bg);
      padding: 16px;
      border-radius: 10px;
      align-items: center;
    }
    .food-highlight img { width: 100px; height: 80px; border-radius: 8px; object-fit: cover; }
    .food-highlight .food-info h4 { font-weight: 600; margin-bottom: 4px; }
    .food-highlight .food-info p { font-size: 0.85rem; color: var(--text-muted); }
    .food-highlight .food-rating { display: flex; align-items: center; gap: 4px; margin-top: 6px; color: var(--gold); font-weight: 600; }

    .reviews-list { display: flex; flex-direction: column; gap: 12px; }
    .review-card { background: var(--bg); padding: 14px; border-radius: 10px; }
    .review-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
    .review-author { font-weight: 600; }
    .review-rating { color: var(--gold); }
    .review-text { font-size: 0.9rem; color: var(--text-muted); }
    .review-time { font-size: 0.75rem; color: #999; margin-top: 6px; }

    .rating-comparison {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .rating-box {
      text-align: center;
      padding: 12px 20px;
      background: var(--bg);
      border-radius: 8px;
    }
    .rating-box .value { font-size: 2rem; font-weight: 800; color: var(--gold); }
    .rating-box .label { font-size: 0.75rem; color: var(--text-muted); }
    .rating-trend { font-size: 0.85rem; color: var(--text-muted); flex: 1; }
    .rating-trend .up { color: var(--success); }
    .rating-trend .down { color: var(--deal); }

    .contact-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }
    .contact-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      background: var(--bg);
      border-radius: 8px;
      text-decoration: none;
      color: var(--text);
      transition: background 0.2s;
    }
    .contact-item:hover { background: #e8f5e9; }
    .contact-item svg { flex-shrink: 0; color: var(--primary); }
    .contact-item .label { font-size: 0.75rem; color: var(--text-muted); }
    .contact-item .value { font-weight: 500; }

    .facilities-grid {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .facility-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    .facility-badge.available { background: #e8f5e9; color: var(--primary); }
    .facility-badge.unavailable { background: #f5f5f5; color: #999; text-decoration: line-through; }

    .weather-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      border-radius: 10px;
      text-decoration: none;
      color: var(--text);
      transition: transform 0.2s;
    }
    .weather-link:hover { transform: translateY(-2px); }
    .weather-link svg { color: #1976d2; }
    .weather-link .weather-text { flex: 1; }
    .weather-link .weather-text strong { display: block; color: #1976d2; }
    .weather-link .weather-text span { font-size: 0.85rem; color: var(--text-muted); }

    @media (max-width: 768px) {
      .tee-time-card { grid-template-columns: 1fr; gap: 12px; }
      .time-block { text-align: left; display: flex; align-items: baseline; gap: 10px; }
      .price-block { text-align: left; }
      .filters-grid { grid-template-columns: 1fr 1fr; }
      .quick-actions-header { flex-direction: column; align-items: stretch; }
      .next-available-btn { justify-content: center; }
      .modal-header { height: 180px; }
      .food-highlight { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Bay Area Golf Tee Times</h1>
      <p>Find available tee times across 40+ public courses</p>
    </div>
  </header>

  <main class="container">
    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button class="tab-btn active" onclick="switchTab('tee-times')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        Tee Times
      </button>
      <button class="tab-btn" onclick="switchTab('courses')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
          <circle cx="12" cy="10" r="3"></circle>
        </svg>
        Courses Directory
      </button>
    </div>

    <!-- Tee Times Tab -->
    <div id="tee-times-tab" class="tab-content active">
      <div class="quick-actions">
        <div class="quick-actions-header">
          <button class="next-available-btn" id="next-available-btn" onclick="toggleNextAvailable()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            Next Available Tee Times
          </button>
          <div class="region-chips">
            <button class="region-chip active" data-region="" onclick="selectRegion('')">All Regions</button>
            <button class="region-chip favorites" data-region="favorites" onclick="selectRegion('favorites')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
              </svg>
              Favorites
            </button>
            <button class="region-chip" data-region="San Francisco" onclick="selectRegion('San Francisco')">SF</button>
            <button class="region-chip" data-region="South Bay" onclick="selectRegion('South Bay')">South Bay</button>
            <button class="region-chip" data-region="East Bay" onclick="selectRegion('East Bay')">East Bay</button>
            <button class="region-chip" data-region="Marin" onclick="selectRegion('Marin')">Marin</button>
          </div>
        </div>
      </div>

      <div class="filters">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="date">Date</label>
          <input type="date" id="date" />
        </div>
        <div class="filter-group">
          <label for="course">Course</label>
          <select id="course">
            <option value="">All Courses</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="players">Players</label>
          <select id="players">
            <option value="">Any</option>
            <option value="1">1+ spots</option>
            <option value="2">2+ spots</option>
            <option value="3">3+ spots</option>
            <option value="4">4 spots</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="min-time">After</label>
          <select id="min-time">
            <option value="">Any time</option>
            <option value="06:00">6:00 AM</option>
            <option value="07:00">7:00 AM</option>
            <option value="08:00">8:00 AM</option>
            <option value="09:00">9:00 AM</option>
            <option value="10:00">10:00 AM</option>
            <option value="11:00">11:00 AM</option>
            <option value="12:00">12:00 PM</option>
            <option value="14:00">2:00 PM</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="max-price">Max Price</label>
          <select id="max-price">
            <option value="">Any price</option>
            <option value="30">Under $30</option>
            <option value="50">Under $50</option>
            <option value="75">Under $75</option>
            <option value="100">Under $100</option>
            <option value="150">Under $150</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="holes">Holes</label>
          <select id="holes">
            <option value="">All</option>
            <option value="18">18 holes</option>
            <option value="9">9 holes</option>
          </select>
        </div>
        <button class="btn" onclick="searchTeeTimes()">Search</button>
      </div>
    </div>

    <div class="results-header">
      <span class="results-count" id="results-count"></span>
      <div class="sort-controls">
        <label>Sort:</label>
        <select id="sort-by" onchange="searchTeeTimes()">
          <option value="datetime">Time</option>
          <option value="price">Price</option>
          <option value="course_name">Course</option>
          <option value="avg_rating">Rating</option>
        </select>
        <select id="sort-order" onchange="searchTeeTimes()">
          <option value="ASC">Asc</option>
          <option value="DESC">Desc</option>
        </select>
      </div>
    </div>

    <div id="results" class="tee-times-grid">
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Loading tee times...</p>
        </div>
      </div>
    </div>

    <!-- Courses Directory Tab -->
    <div id="courses-tab" class="tab-content">
      <div class="quick-actions">
        <div class="quick-actions-header">
          <h2 style="margin: 0; font-size: 1.3rem;">All Courses</h2>
          <div class="region-chips">
            <button class="region-chip active" data-dir-region="" onclick="filterDirectoryByRegion('')">All</button>
            <button class="region-chip favorites" data-dir-region="favorites" onclick="filterDirectoryByRegion('favorites')">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
              </svg>
              Favorites
            </button>
            <button class="region-chip" data-dir-region="San Francisco" onclick="filterDirectoryByRegion('San Francisco')">SF</button>
            <button class="region-chip" data-dir-region="South Bay" onclick="filterDirectoryByRegion('South Bay')">South Bay</button>
            <button class="region-chip" data-dir-region="East Bay" onclick="filterDirectoryByRegion('East Bay')">East Bay</button>
            <button class="region-chip" data-dir-region="Marin" onclick="filterDirectoryByRegion('Marin')">Marin</button>
          </div>
        </div>
      </div>

      <div id="courses-directory" class="courses-grid">
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Loading courses...</p>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>Bay Area Golf Tee Times Aggregator</p>
  </footer>

  <!-- Course Detail Modal -->
  <div class="modal-overlay" id="course-modal" onclick="closeModalOnOverlay(event)">
    <div class="modal">
      <div class="modal-header" id="modal-header">
        <img id="modal-hero-img" src="" alt="Course photo">
        <div class="modal-header-overlay">
          <h2 id="modal-course-name"></h2>
          <div class="subtitle" id="modal-course-location"></div>
        </div>
        <button class="modal-fav-btn" id="modal-fav-btn" onclick="toggleFavoriteFromModal(event)">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e91e63" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
        </button>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- Content loaded dynamically -->
      </div>
    </div>
  </div>

  <script>
    const API_BASE = '/api';
    let isNextAvailableMode = false;
    let selectedRegion = '';
    let directoryRegion = '';
    let coursesData = [];
    let currentCourseId = null;

    // Favorites management
    function getFavorites() {
      try {
        return JSON.parse(localStorage.getItem('golfFavorites') || '[]');
      } catch (e) { return []; }
    }

    function saveFavorites(favorites) {
      localStorage.setItem('golfFavorites', JSON.stringify(favorites));
    }

    function isFavorite(courseId) {
      return getFavorites().includes(courseId);
    }

    function toggleFavorite(courseId, event) {
      if (event) event.stopPropagation();
      const favorites = getFavorites();
      const index = favorites.indexOf(courseId);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        favorites.push(courseId);
      }
      saveFavorites(favorites);
      updateFavoriteButtons(courseId);
      // If we're filtering by favorites, refresh the views
      if (selectedRegion === 'favorites') searchTeeTimes();
      if (directoryRegion === 'favorites') renderCoursesDirectory();
    }

    function toggleFavoriteFromModal(event) {
      if (currentCourseId) {
        toggleFavorite(currentCourseId, event);
      }
    }

    function updateFavoriteButtons(courseId) {
      const isFav = isFavorite(courseId);
      // Update directory card button
      const cardBtn = document.querySelector(`.course-card[data-id="${courseId}"] .fav-btn`);
      if (cardBtn) cardBtn.classList.toggle('favorited', isFav);
      // Update modal button
      if (currentCourseId === courseId) {
        document.getElementById('modal-fav-btn').classList.toggle('favorited', isFav);
      }
    }

    // Tab switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`.tab-btn[onclick="switchTab('${tabName}')"]`).classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');
      if (tabName === 'courses') {
        renderCoursesDirectory();
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('date').value = today;
      loadCourses();
      searchTeeTimes();
    });

    async function loadCourses() {
      try {
        const res = await fetch(`${API_BASE}/courses`);
        coursesData = await res.json();
        updateCourseDropdown();
      } catch (e) { console.error('Error loading courses:', e); }
    }

    function updateCourseDropdown() {
      const select = document.getElementById('course');
      select.innerHTML = '<option value="">All Courses</option>';
      let filtered = coursesData;
      if (selectedRegion && selectedRegion !== 'favorites') {
        filtered = coursesData.filter(c => c.region === selectedRegion);
      } else if (selectedRegion === 'favorites') {
        const favs = getFavorites();
        filtered = coursesData.filter(c => favs.includes(c.id));
      }
      filtered.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.textContent = `${c.name} (${c.city})`;
        select.appendChild(opt);
      });
    }

    function toggleNextAvailable() {
      isNextAvailableMode = !isNextAvailableMode;
      const btn = document.getElementById('next-available-btn');
      const dateInput = document.getElementById('date');
      if (isNextAvailableMode) {
        btn.classList.add('active');
        btn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> Showing All Next Available`;
        dateInput.disabled = true;
      } else {
        btn.classList.remove('active');
        btn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> Next Available Tee Times`;
        dateInput.disabled = false;
      }
      searchTeeTimes();
    }

    function selectRegion(region) {
      selectedRegion = region;
      document.querySelectorAll('#tee-times-tab .region-chip').forEach(chip => {
        chip.classList.toggle('active', chip.dataset.region === region);
      });
      updateCourseDropdown();
      searchTeeTimes();
    }

    function filterDirectoryByRegion(region) {
      directoryRegion = region;
      document.querySelectorAll('#courses-tab .region-chip').forEach(chip => {
        chip.classList.toggle('active', chip.dataset.dirRegion === region);
      });
      renderCoursesDirectory();
    }

    function renderCoursesDirectory() {
      const container = document.getElementById('courses-directory');
      let filtered = [...coursesData];

      if (directoryRegion === 'favorites') {
        const favs = getFavorites();
        filtered = filtered.filter(c => favs.includes(c.id));
      } else if (directoryRegion) {
        filtered = filtered.filter(c => c.region === directoryRegion);
      }

      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="no-results" style="grid-column: 1/-1;">
            <h3>${directoryRegion === 'favorites' ? 'No favorites yet' : 'No courses found'}</h3>
            <p>${directoryRegion === 'favorites' ? 'Click the heart icon on any course to add it to your favorites.' : 'Try selecting a different region.'}</p>
          </div>
        `;
        return;
      }

      container.innerHTML = filtered.map(course => {
        const isFav = isFavorite(course.id);
        const imgUrl = course.photo_url || `https://picsum.photos/seed/${course.id}/400/200`;
        return `
          <div class="course-card" data-id="${course.id}" onclick="openCourseDetail(${course.id})">
            <div class="course-card-img">
              <img src="${imgUrl}" alt="${course.name}" loading="lazy">
            </div>
            <div class="course-card-body">
              <div class="course-card-header">
                <h3>${course.name}</h3>
                <button class="fav-btn ${isFav ? 'favorited' : ''}" onclick="toggleFavorite(${course.id}, event)" title="${isFav ? 'Remove from favorites' : 'Add to favorites'}">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#e91e63" stroke-width="2">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                  </svg>
                </button>
              </div>
              <div class="location">${course.city}, ${course.region}</div>
              <div class="course-meta">
                <span class="meta-item"><strong>${course.holes}</strong> holes</span>
                ${course.par ? `<span class="meta-item">Par <strong>${course.par}</strong></span>` : ''}
                ${course.yardage ? `<span class="meta-item"><strong>${course.yardage.toLocaleString()}</strong> yards</span>` : ''}
              </div>
              <div class="course-card-footer">
                <span class="tee-times-count">View tee times</span>
                ${course.avg_rating ? `<span class="rating-display">‚òÖ ${course.avg_rating.toFixed(1)}</span>` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function searchTeeTimes() {
      const resultsEl = document.getElementById('results');
      resultsEl.innerHTML = `<div class="loading"><div class="loading-spinner"></div><p>Searching...</p></div>`;

      const params = new URLSearchParams();
      if (isNextAvailableMode) params.set('next_available', 'true');
      else { const date = document.getElementById('date').value; if (date) params.set('date', date); }
      // Don't pass 'favorites' as region to API - we'll filter client-side
      if (selectedRegion && selectedRegion !== 'favorites') params.set('region', selectedRegion);
      const course = document.getElementById('course').value;
      if (course) params.set('course_id', course);
      const players = document.getElementById('players').value;
      if (players) params.set('players', players);
      const minTime = document.getElementById('min-time').value;
      if (minTime) params.set('min_time', minTime);
      const maxPrice = document.getElementById('max-price').value;
      if (maxPrice) params.set('max_price', maxPrice);
      const holes = document.getElementById('holes').value;
      if (holes) params.set('holes', holes);
      params.set('sort_by', document.getElementById('sort-by').value);
      params.set('sort_order', document.getElementById('sort-order').value);
      params.set('limit', '100');

      try {
        const res = await fetch(`${API_BASE}/tee-times?${params}`);
        let teeTimes = await res.json();

        // Filter by favorites if selected
        if (selectedRegion === 'favorites') {
          const favs = getFavorites();
          teeTimes = teeTimes.filter(tt => favs.includes(tt.course_id));
        }

        const modeText = isNextAvailableMode ? 'next available ' : '';
        const regionText = selectedRegion === 'favorites' ? ' at favorite courses' : (selectedRegion ? ` in ${selectedRegion}` : '');
        document.getElementById('results-count').textContent = `${teeTimes.length} ${modeText}tee times found${regionText}`;

        if (teeTimes.length === 0) {
          const noFavsMsg = selectedRegion === 'favorites' ? 'Add some courses to your favorites first!' : 'Try adjusting your filters.';
          resultsEl.innerHTML = `<div class="no-results"><h3>No tee times found</h3><p>${noFavsMsg}</p></div>`;
          return;
        }
        resultsEl.innerHTML = teeTimes.map(tt => renderTeeTime(tt)).join('');
      } catch (e) {
        console.error('Error:', e);
        resultsEl.innerHTML = `<div class="no-results"><h3>Error loading</h3><p>Please try again.</p></div>`;
      }
    }

    function renderTeeTime(tt) {
      const time = formatTime(tt.time);
      const date = formatDate(tt.date);
      const price = tt.price ? `$${Math.round(tt.price)}` : 'Call';
      const hasDiscount = tt.original_price && tt.original_price > tt.price;
      const course = coursesData.find(c => c.id === tt.course_id) || {};
      const rating = course.avg_rating ? course.avg_rating.toFixed(1) : null;

      return `
        <div class="tee-time-card">
          <div class="time-block">
            <div class="time">${time}</div>
            <div class="date">${date}</div>
          </div>
          <div class="course-info">
            <h3><a onclick="openCourseDetail(${tt.course_id})">${tt.course_name}</a></h3>
            <div class="location">${tt.city}, ${tt.region}</div>
            <div class="badges">
              <span class="badge holes">${tt.holes || 18}H</span>
              <span class="badge players">${tt.players || 4} spots</span>
              ${rating ? `<span class="badge rating">‚òÖ ${rating}</span>` : ''}
              ${tt.has_cart ? '<span class="badge">Cart</span>' : ''}
            </div>
          </div>
          <div class="price-block">
            ${hasDiscount ? `<div class="original-price">$${Math.round(tt.original_price)}</div>` : ''}
            <div class="price">${price}</div>
            ${hasDiscount ? '<div class="deal-tag">HOT DEAL</div>' : ''}
          </div>
          <a href="${tt.booking_url}" target="_blank" rel="noopener" class="book-btn">Book</a>
        </div>
      `;
    }

    async function openCourseDetail(courseId) {
      currentCourseId = courseId;
      const modal = document.getElementById('course-modal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      document.getElementById('modal-body').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

      // Update favorite button state
      const favBtn = document.getElementById('modal-fav-btn');
      favBtn.classList.toggle('favorited', isFavorite(courseId));

      try {
        const res = await fetch(`${API_BASE}/courses/${courseId}`);
        const course = await res.json();
        renderCourseDetail(course);
      } catch (e) {
        console.error('Error loading course:', e);
        document.getElementById('modal-body').innerHTML = '<p>Error loading course details.</p>';
      }
    }

    function renderCourseDetail(course) {
      const heroImg = course.photos?.[0]?.url || course.photo_url || `https://picsum.photos/seed/${course.id}/800/400`;
      document.getElementById('modal-hero-img').src = heroImg;
      document.getElementById('modal-course-name').textContent = course.name;
      document.getElementById('modal-course-location').textContent = `${course.city}, ${course.region} ‚Ä¢ ${course.holes} holes`;

      const recentAvg = course.recent_avg_rating?.toFixed(1) || 'N/A';
      const allTimeAvg = course.avg_rating?.toFixed(1) || 'N/A';
      const ratingDiff = course.recent_avg_rating && course.avg_rating ? (course.recent_avg_rating - course.avg_rating).toFixed(1) : null;
      const ratingTrend = ratingDiff ? (ratingDiff > 0 ? `<span class="up">‚Üë ${ratingDiff} higher</span>` : ratingDiff < 0 ? `<span class="down">‚Üì ${Math.abs(ratingDiff)} lower</span>` : 'Same') : '';

      // Weather Underground URL using lat/lng
      const weatherUrl = course.latitude && course.longitude
        ? `https://www.wunderground.com/hourly/us/ca/${course.city.toLowerCase().replace(/\s+/g, '-')}/${course.latitude},${course.longitude}`
        : `https://www.wunderground.com/weather/us/ca/${course.city.toLowerCase().replace(/\s+/g, '-')}`;

      let html = `
        <div class="modal-section">
          <h3>üìû Contact & Info</h3>
          <div class="contact-info">
            ${course.phone_number ? `
              <a href="tel:${course.phone_number.replace(/[^0-9]/g, '')}" class="contact-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                <div><div class="label">Clubhouse</div><div class="value">${course.phone_number}</div></div>
              </a>
            ` : ''}
            ${course.website_url ? `
              <a href="${course.website_url}" target="_blank" class="contact-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="2" y1="12" x2="22" y2="12"></line>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                </svg>
                <div><div class="label">Website</div><div class="value">Visit Course Site</div></div>
              </a>
            ` : ''}
          </div>
        </div>

        <div class="modal-section">
          <h3>üå§Ô∏è Weather</h3>
          <a href="${weatherUrl}" target="_blank" class="weather-link">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 18a5 5 0 0 0-2.18-9.43A8 8 0 1 0 3 16.29"></path>
              <circle cx="12" cy="12" r="3"></circle>
              <line x1="12" y1="5" x2="12" y2="3"></line>
              <line x1="17" y1="7" x2="18.4" y2="5.6"></line>
              <line x1="19" y1="12" x2="21" y2="12"></line>
            </svg>
            <div class="weather-text">
              <strong>View Hourly Forecast</strong>
              <span>Weather Underground - ${course.city}</span>
            </div>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
          </a>
        </div>

        <div class="modal-section">
          <h3>‚õ≥ Practice Facilities</h3>
          <div class="facilities-grid">
            <div class="facility-badge ${course.has_driving_range ? 'available' : 'unavailable'}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                ${course.has_driving_range ? '<polyline points="20 6 9 17 4 12"></polyline>' : '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'}
              </svg>
              Driving Range
            </div>
            <div class="facility-badge ${course.has_practice_green ? 'available' : 'unavailable'}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                ${course.has_practice_green ? '<polyline points="20 6 9 17 4 12"></polyline>' : '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'}
              </svg>
              Practice Green
            </div>
            <div class="facility-badge ${course.has_pro_shop ? 'available' : 'unavailable'}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                ${course.has_pro_shop ? '<polyline points="20 6 9 17 4 12"></polyline>' : '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'}
              </svg>
              Pro Shop
            </div>
          </div>
        </div>

        <div class="modal-section">
          <h3>üìä Course Stats</h3>
          <div class="course-stats">
            <div class="course-stat"><div class="value">${course.par || '-'}</div><div class="label">Par</div></div>
            <div class="course-stat"><div class="value">${course.yardage?.toLocaleString() || '-'}</div><div class="label">Yards</div></div>
            <div class="course-stat"><div class="value">${course.slope_rating || '-'}</div><div class="label">Slope</div></div>
            <div class="course-stat"><div class="value">${course.course_rating || '-'}</div><div class="label">Rating</div></div>
            <div class="course-stat"><div class="value">${course.upcoming_tee_times}</div><div class="label">Available</div></div>
          </div>
        </div>
      `;

      if (course.course_record_score) {
        html += `
          <div class="modal-section">
            <h3>üèÜ Course Record</h3>
            <div class="course-record">
              <div class="score">${course.course_record_score}</div>
              <div class="holder">${course.course_record_holder} (${course.course_record_date})</div>
              <div class="details">${course.course_record_details || ''}</div>
            </div>
          </div>
        `;
      }

      if (course.reviews?.length > 0) {
        html += `
          <div class="modal-section">
            <h3>‚≠ê Reviews</h3>
            <div class="rating-comparison">
              <div class="rating-box"><div class="value">${recentAvg}</div><div class="label">Recent (10)</div></div>
              <div class="rating-box"><div class="value">${allTimeAvg}</div><div class="label">All Time</div></div>
              <div class="rating-trend">Recent reviews are ${ratingTrend} than all-time average</div>
            </div>
            <div class="reviews-list" style="margin-top: 16px;">
              ${course.reviews.slice(0, 5).map(r => `
                <div class="review-card">
                  <div class="review-header">
                    <span class="review-author">${r.author_name}</span>
                    <span class="review-rating">${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5-r.rating)}</span>
                  </div>
                  <div class="review-text">${r.text}</div>
                  <div class="review-time">${r.relative_time}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (course.photos?.length > 0) {
        html += `
          <div class="modal-section">
            <h3>üì∑ Photos</h3>
            <div class="photos-grid">
              ${course.photos.map(p => `
                <div class="photo-card">
                  <img src="${p.url}" alt="${p.caption || 'Course photo'}">
                  ${p.year_taken ? `<span class="year">${p.year_taken}</span>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (course.top_food) {
        html += `
          <div class="modal-section">
            <h3>üçî Top-Rated Clubhouse Food</h3>
            <div class="food-highlight">
              <img src="${course.top_food.photo_url}" alt="${course.top_food.name}">
              <div class="food-info">
                <h4>${course.top_food.name}</h4>
                <p>${course.top_food.description}</p>
                <div class="food-rating">‚òÖ ${course.top_food.avg_rating?.toFixed(1)} (${course.top_food.mention_count} mentions)</div>
              </div>
            </div>
          </div>
        `;
      }

      if (course.website_url) {
        html += `
          <div class="modal-section" style="text-align: center;">
            <a href="${course.website_url}" target="_blank" class="btn" style="display: inline-block;">Visit Course Website</a>
          </div>
        `;
      }

      document.getElementById('modal-body').innerHTML = html;
    }

    function closeModal() {
      document.getElementById('course-modal').classList.remove('active');
      document.body.style.overflow = '';
    }

    function closeModalOnOverlay(e) {
      if (e.target.id === 'course-modal') closeModal();
    }

    function formatTime(t) {
      if (!t) return '';
      if (t.includes('AM') || t.includes('PM')) return t;
      const [h, m] = t.split(':');
      const hr = parseInt(h);
      return `${hr % 12 || 12}:${m} ${hr >= 12 ? 'PM' : 'AM'}`;
    }

    function formatDate(d) {
      if (!d) return '';
      const date = new Date(d + 'T00:00:00');
      return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    }

    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
  </script>
</body>
</html>
