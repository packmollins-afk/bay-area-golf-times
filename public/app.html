<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Primary Meta Tags -->
  <title>Bay Area Golf Tee Times | Find & Book Tee Times at 40+ Public Courses</title>
  <meta name="title" content="Bay Area Golf Tee Times | Find & Book Tee Times at 40+ Public Courses">
  <meta name="description" content="Find and book the best golf tee times across 40+ public courses in San Francisco, South Bay, East Bay, North Bay, and Napa. Compare prices, check availability, and save on your next round of golf in the Bay Area.">
  <meta name="keywords" content="bay area golf, tee times, golf courses san francisco, south bay golf, east bay golf, north bay golf, napa golf, book tee times, golf deals, public golf courses, bay area golf courses, golf reservations">
  <meta name="author" content="Bay Area Golf Tee Times">
  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow">

  <!-- Canonical URL -->
  <link rel="canonical" href="https://bayareagolf.now">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://bayareagolf.now/">
  <meta property="og:title" content="Bay Area Golf Tee Times | Find & Book Tee Times at 40+ Public Courses">
  <meta property="og:description" content="Find and book the best golf tee times across 40+ public courses in San Francisco, South Bay, East Bay, North Bay, and Napa. Compare prices and save on your next round.">
  <meta property="og:image" content="https://bayareagolf.now/og-image.svg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="Bay Area Golf Tee Times">
  <meta property="og:locale" content="en_US">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://bayareagolf.now/">
  <meta name="twitter:title" content="Bay Area Golf Tee Times | Find & Book Tee Times at 40+ Public Courses">
  <meta name="twitter:description" content="Find and book the best golf tee times across 40+ public courses in San Francisco, South Bay, East Bay, North Bay, and Napa.">
  <meta name="twitter:image" content="https://bayareagolf.now/og-image.svg">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#2d5a27">
  <meta name="msapplication-TileColor" content="#2d5a27">

  <!-- PWA / iOS App -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Bay Area Golf">
  <link rel="apple-touch-startup-image" href="/icons/icon-512x512.png">

  <!-- Preconnect to external origins -->
  <link rel="preconnect" href="https://picsum.photos">
  <link rel="dns-prefetch" href="https://picsum.photos">

  <!-- Geo Meta Tags for Local SEO -->
  <meta name="geo.region" content="US-CA">
  <meta name="geo.placename" content="San Francisco Bay Area">
  <meta name="geo.position" content="37.7749;-122.4194">
  <meta name="ICBM" content="37.7749, -122.4194">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Bay Area Golf Tee Times",
    "url": "https://bayareagolf.now",
    "description": "Find and book golf tee times across 40+ public courses in the San Francisco Bay Area including San Francisco, South Bay, East Bay, North Bay, and Napa.",
    "applicationCategory": "SportsApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.5",
      "ratingCount": "150"
    },
    "areaServed": {
      "@type": "GeoCircle",
      "geoMidpoint": {
        "@type": "GeoCoordinates",
        "latitude": 37.7749,
        "longitude": -122.4194
      },
      "geoRadius": "80000"
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Bay Area Golf Tee Times",
    "@id": "https://bayareagolf.now",
    "url": "https://bayareagolf.now",
    "description": "Bay Area golf tee time aggregator covering 40+ public golf courses",
    "areaServed": [
      {
        "@type": "City",
        "name": "San Francisco",
        "sameAs": "https://en.wikipedia.org/wiki/San_Francisco"
      },
      {
        "@type": "AdministrativeArea",
        "name": "South Bay",
        "containedInPlace": {
          "@type": "AdministrativeArea",
          "name": "San Francisco Bay Area"
        }
      },
      {
        "@type": "AdministrativeArea",
        "name": "East Bay"
      },
      {
        "@type": "AdministrativeArea",
        "name": "North Bay"
      },
      {
        "@type": "AdministrativeArea",
        "name": "Napa"
      }
    ],
    "priceRange": "$30-$200"
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "Bay Area Golf Courses",
    "description": "Public golf courses in San Francisco Bay Area",
    "numberOfItems": 40,
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@type": "GolfCourse",
          "name": "Various Bay Area Golf Courses",
          "address": {
            "@type": "PostalAddress",
            "addressRegion": "CA",
            "addressCountry": "US"
          }
        }
      }
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://bayareagolf.now"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Tee Times",
        "item": "https://bayareagolf.now/#tee-times"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "Courses",
        "item": "https://bayareagolf.now/#courses"
      }
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "How do I book a tee time in the Bay Area?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Use Bay Area Golf Tee Times to search for available tee times across 40+ public courses in San Francisco, South Bay, East Bay, North Bay, and Napa. Filter by date, time, and price, then click 'Book' to reserve your spot directly with the course."
        }
      },
      {
        "@type": "Question",
        "name": "What golf courses are available in the San Francisco Bay Area?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The Bay Area has over 40 public golf courses including popular options like Presidio Golf Course, TPC Harding Park, Lincoln Park Golf Course, Sharp Park Golf Course, Crystal Springs Golf Course, and Palo Alto Municipal Golf Course. Courses span San Francisco, South Bay, East Bay, North Bay, and Napa regions."
        }
      },
      {
        "@type": "Question",
        "name": "What is the average price for golf in the Bay Area?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Golf green fees in the Bay Area typically range from $30 to $200 depending on the course, time of day, and day of week. Twilight rates and weekday specials often offer significant savings. Use our price filter to find deals that fit your budget."
        }
      },
      {
        "@type": "Question",
        "name": "Can I book same-day tee times?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! Many Bay Area golf courses offer same-day tee time bookings. Use the 'Next Available' feature to quickly find the earliest available tee times across all courses, or filter by today's date to see what's open."
        }
      },
      {
        "@type": "Question",
        "name": "Which Bay Area golf courses are best for beginners?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Great beginner-friendly courses in the Bay Area include Lincoln Park Golf Course (San Francisco), Sunken Garden Golf Course (Sunnyvale), and Chuck Corica Golf Complex (Alameda). Look for courses with shorter yardage, wider fairways, and practice facilities."
        }
      }
    ]
  }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/animations.css">

  <style>
    :root {
      --primary: #2d5a27;
      --primary-light: #4a7a3f;
      --primary-dark: #1a3d17;
      --bg: #f4f1e8;
      --bg-paper: #f9f6ef;
      --card-bg: #fffef9;
      --text: #3d2914;
      --text-muted: #6b5344;
      --border: #c4a882;
      --border-light: #ddd0bc;
      --success: #2d5a27;
      --deal: #8b2500;
      --gold: #b8860b;
      --contour: #8b7355;
      --water: #5d8aa8;

      /* Animation tokens */
      --anim-instant: 100ms;
      --anim-fast: 200ms;
      --anim-normal: 350ms;
      --anim-slow: 500ms;
      --ease-out: cubic-bezier(0.33, 1, 0.68, 1);
      --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Source Serif 4', Georgia, 'Times New Roman', serif;
      background: var(--bg);
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(139, 115, 85, 0.03) 40px, rgba(139, 115, 85, 0.03) 41px),
        repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(139, 115, 85, 0.03) 40px, rgba(139, 115, 85, 0.03) 41px);
      color: var(--text);
      line-height: 1.6;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

    header {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: #f4f1e8;
      padding: 16px 0;
      border-bottom: 4px solid var(--border);
      box-shadow: 0 4px 12px rgba(61, 41, 20, 0.15);
    }
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header-nav {
      display: flex;
      gap: 10px;
    }
    .nav-btn {
      color: #f4f1e8;
      text-decoration: none;
      font-family: 'Playfair Display', Georgia, serif;
      padding: 8px 14px;
      border: 2px solid rgba(255,255,255,0.5);
      border-radius: 4px;
      transition: all 0.2s;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .nav-btn:hover { background: rgba(255,255,255,0.1); border-color: #fff; }
    .nav-btn.active { background: rgba(255,255,255,0.15); border-color: #fff; }
    .nav-btn svg { width: 16px; height: 16px; }
    .nav-btn-ai {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      border-color: #fbbf24;
      color: #1a1a1a;
      font-weight: 600;
    }
    .nav-btn-ai:hover {
      background: linear-gradient(135deg, #fcd34d, #fbbf24);
      border-color: #fcd34d;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
    }
    .nav-btn-ai svg { stroke: #1a1a1a; }
    @media (max-width: 600px) {
      .header-content { flex-direction: column; gap: 12px; }
      header h1 { font-size: 1.2rem; }
      .header-nav { flex-wrap: wrap; justify-content: center; }
      .nav-btn { padding: 6px 10px; font-size: 0.8rem; }
    }
    header h1 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }
    header p {
      opacity: 0.9;
      margin-top: 6px;
      font-style: italic;
    }

    /* Filter Tabs */
    .filter-tabs {
      display: flex;
      gap: 14px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    .filter-tab {
      padding: 14px 28px;
      background: white;
      border: 2px solid var(--border-light);
      border-radius: 30px;
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text);
      position: relative;
      overflow: hidden;
      transition: all var(--anim-fast) var(--ease-out);
      box-shadow: 0 2px 8px rgba(61, 41, 20, 0.06);
    }
    .filter-tab::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent, rgba(255,255,255,0.5));
      opacity: 0;
      transition: opacity var(--anim-fast) var(--ease-out);
    }
    .filter-tab:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(61, 41, 20, 0.12);
    }
    .filter-tab:hover::before {
      opacity: 1;
    }
    .filter-tab:active {
      transform: translateY(-1px);
    }
    .filter-tab.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #f4f1e8;
      border-color: transparent;
      box-shadow: 0 4px 16px rgba(45, 90, 39, 0.3);
    }
    .filter-tab.active svg {
      fill: #f4f1e8;
      stroke: #f4f1e8;
    }
    .filter-tab[data-filter="staff_picks"] {
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      border-color: var(--gold);
      color: #92650a;
    }
    .filter-tab[data-filter="staff_picks"] svg {
      fill: var(--gold);
    }
    .filter-tab[data-filter="staff_picks"]:hover {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      box-shadow: 0 6px 20px rgba(184, 134, 11, 0.2);
    }
    .filter-tab[data-filter="staff_picks"].active {
      background: linear-gradient(135deg, var(--gold), #92650a);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 4px 16px rgba(184, 134, 11, 0.4);
    }
    .filter-tab[data-filter="staff_picks"].active svg {
      fill: #fff;
    }
    .filter-tab[data-filter="favorites"] {
      background: linear-gradient(135deg, #fdf5f5, #fce4ec);
      border-color: #e91e63;
      color: #c2185b;
    }
    .filter-tab[data-filter="favorites"]:hover {
      background: linear-gradient(135deg, #fce4ec, #f8bbd9);
      box-shadow: 0 6px 20px rgba(233, 30, 99, 0.15);
    }
    .filter-tab[data-filter="favorites"].active {
      background: linear-gradient(135deg, #e91e63, #c2185b);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 4px 16px rgba(233, 30, 99, 0.4);
    }
    .filter-tab[data-filter="favorites"].active svg {
      stroke: #fff;
      fill: none;
    }

    .filter-divider {
      width: 2px;
      background: var(--border-light);
      margin: 0 4px;
      align-self: stretch;
    }
    .filter-tab.region-tab {
      padding: 10px 18px;
      font-size: 0.9rem;
      background: var(--bg-paper);
    }
    .filter-tab.region-tab.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #f4f1e8;
      border-color: transparent;
    }

    .region-chips { display: flex; gap: 10px; flex-wrap: wrap; }
    .region-chip {
      padding: 8px 18px;
      background: var(--bg-paper);
      border: 2px solid var(--border-light);
      border-radius: 4px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Playfair Display', Georgia, serif;
    }
    .region-chip:hover { background: #e8efe6; border-color: var(--primary); }
    .region-chip.active { background: var(--primary); color: #f4f1e8; border-color: var(--primary-dark); }
    .region-chip.favorites { background: #fdf5f5; border-color: var(--deal); color: var(--deal); }
    .region-chip.favorites:hover { background: #fce8e8; }
    .region-chip.favorites.active { background: var(--deal); color: #f4f1e8; }
    .region-chip.staff-picks { background: #fffbeb; border-color: var(--gold); color: var(--gold); }
    .region-chip.staff-picks:hover { background: #fef3c7; }
    .region-chip.staff-picks.active { background: var(--gold); color: #f4f1e8; }

    .directory-controls { display: flex; flex-direction: column; gap: 12px; }
    .sort-control {
      display: flex;
      align-items: center;
      gap: 8px;
      align-self: flex-start;
    }
    .sort-control label { font-size: 0.9rem; color: var(--text-muted); }
    .sort-control select {
      padding: 6px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      background: white;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .sort-control select:hover { border-color: var(--primary); }
    @media (min-width: 768px) {
      .directory-controls { flex-direction: row; justify-content: space-between; align-items: center; }
      .sort-control { align-self: center; }
    }

    /* Page Title Bar */
    .page-title-bar {
      text-align: center;
      padding: 24px 0;
      margin-bottom: 16px;
    }
    .page-title-bar h2 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }
    .page-title-bar p {
      color: var(--text-muted);
      font-style: italic;
    }

    /* Quick Filters */
    .quick-filters {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .quick-filter-btn {
      padding: 10px 20px;
      background: var(--bg-paper);
      border: 2px solid var(--border-light);
      border-radius: 4px;
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text);
    }
    .quick-filter-btn:hover {
      border-color: var(--primary);
      background: #e8efe6;
    }
    .quick-filter-btn.active {
      background: var(--primary);
      color: #f4f1e8;
      border-color: var(--primary-dark);
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Courses Directory */
    .courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
    }
    .course-card {
      background: var(--card-bg);
      border-radius: 4px;
      overflow: hidden;
      border: 2px solid var(--border-light);
      box-shadow: 0 3px 10px rgba(61, 41, 20, 0.08);
      transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
      cursor: pointer;
    }
    .course-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(61, 41, 20, 0.15); border-color: var(--primary); }
    .course-card-img {
      height: 180px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      position: relative;
      overflow: hidden;
      border-bottom: 3px solid var(--border);
    }
    .course-card-img img { width: 100%; height: 100%; object-fit: cover; }
    .course-card-body { padding: 18px; }
    .course-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
    .course-card-header h3 { font-family: 'Playfair Display', Georgia, serif; font-size: 1.15rem; font-weight: 700; color: var(--text); margin: 0; }
    .course-card .location { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; font-style: italic; }
    .course-card .course-meta { display: flex; gap: 14px; flex-wrap: wrap; }
    .course-card .meta-item { font-size: 0.8rem; color: var(--text-muted); display: flex; align-items: center; gap: 4px; }
    .course-card .meta-item strong { color: var(--text); font-weight: 700; }
    .course-card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 14px; padding-top: 14px; border-top: 2px solid var(--border-light); }
    .course-card .tee-times-count { font-size: 0.85rem; color: var(--primary); font-weight: 600; }
    .course-card .rating-display { display: flex; align-items: center; gap: 4px; color: var(--gold); font-weight: 700; font-size: 1rem; }

    /* Favorite Button */
    .fav-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: rgba(0,0,0,0.05);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    .fav-btn:hover { background: #fce4ec; }
    .fav-btn svg { transition: all 0.2s; }
    .fav-btn.favorited { background: #fce4ec; }
    .fav-btn.favorited svg { fill: #e91e63; stroke: #e91e63; }

    .modal-fav-btn {
      position: absolute;
      top: 16px;
      left: 16px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      background: rgba(255,255,255,0.9);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .modal-fav-btn:hover { background: white; transform: scale(1.1); }
    .modal-fav-btn.favorited svg { fill: #e91e63; stroke: #e91e63; }

    .filters {
      background: var(--card-bg);
      padding: 24px;
      border-radius: 4px;
      margin-bottom: 24px;
      border: 2px solid var(--border-light);
      box-shadow: 0 3px 10px rgba(61, 41, 20, 0.08);
    }
    /* Week Date Picker */
    .week-picker {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding: 4px 0;
      -webkit-overflow-scrolling: touch;
    }
    .week-picker::-webkit-scrollbar { display: none; }
    .day-btn {
      flex: 1;
      min-width: 70px;
      max-width: 90px;
      padding: 12px 8px;
      border: 2px solid var(--border-light);
      border-radius: 8px;
      background: var(--card-bg);
      cursor: pointer;
      text-align: center;
      transition: all 0.2s ease;
      font-family: inherit;
    }
    .day-btn:hover {
      border-color: var(--primary);
      background: var(--surface);
    }
    .day-btn.active {
      border-color: var(--primary);
      background: var(--primary);
      color: white;
    }
    .day-btn .day-name {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.8;
    }
    .day-btn .day-date {
      font-size: 1.25rem;
      font-weight: 700;
      margin-top: 2px;
    }
    .day-btn.active .day-name,
    .day-btn.active .day-date {
      color: white;
    }

    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 16px;
      align-items: end;
    }
    .filter-group { display: flex; flex-direction: column; gap: 6px; }
    .filter-group label { font-size: 0.85rem; font-weight: 600; color: var(--text-muted); font-family: 'Playfair Display', Georgia, serif; }
    .filter-group select, .filter-group input {
      padding: 10px 12px;
      border: 2px solid var(--border-light);
      border-radius: 4px;
      font-size: 0.95rem;
      font-family: 'Source Serif 4', Georgia, serif;
      background: var(--bg-paper);
      cursor: pointer;
      color: var(--text);
    }
    .filter-group select:focus, .filter-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(45, 90, 39, 0.1);
    }
    .filter-group input:disabled { background: var(--border-light); cursor: not-allowed; }

    .btn {
      padding: 12px 24px;
      background: var(--primary);
      color: #f4f1e8;
      border: 2px solid var(--primary-dark);
      border-radius: 4px;
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .btn:hover { background: var(--primary-light); }

    /* Booking action buttons */
    .booking-actions { padding: 20px 0; }
    .booking-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .btn-action {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 24px;
      font-size: 1rem;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.2s;
      flex: 1;
      justify-content: center;
      min-width: 140px;
      background: linear-gradient(135deg, #2d5016, #3d6b1e);
      color: #fff;
      border: 2px solid #2d5016;
    }
    .btn-action:hover {
      background: linear-gradient(135deg, #3d6b1e, #4a7d24);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(45, 80, 22, 0.3);
    }
    .btn-secondary {
      background: var(--cream);
      color: var(--text);
      border: 2px solid var(--border);
    }
    .btn-secondary:hover {
      background: #fff;
      border-color: var(--primary);
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .results-count { font-size: 0.95rem; color: var(--text-muted); }
    .sort-controls { display: flex; gap: 8px; align-items: center; }
    .sort-controls select { padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 0.9rem; }

    /* Grouped Time Slots */
    .tee-times-grid {
      display: grid;
      gap: 20px;
    }

    .time-slot-card {
      background: var(--card-bg);
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid var(--border-light);
      box-shadow: 0 4px 16px rgba(61, 41, 20, 0.08);
      opacity: 0;
      animation: fadeInUp var(--anim-normal) var(--ease-out) forwards;
      transition: box-shadow var(--anim-fast) var(--ease-out),
                  transform var(--anim-fast) var(--ease-out);
    }

    .time-slot-card:hover {
      box-shadow: 0 8px 32px rgba(61, 41, 20, 0.12);
      transform: translateY(-2px);
    }

    .time-slot-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 28px;
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--primary-light) 100%);
      color: #f4f1e8;
      border-bottom: 3px solid var(--border);
      position: relative;
      overflow: hidden;
    }

    .time-slot-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 200%; }
    }

    .time-slot-time {
      display: flex;
      align-items: baseline;
      gap: 16px;
    }

    .time-slot-time .time {
      font-family: 'DM Mono', 'Courier New', monospace;
      font-size: 1.8rem;
      font-weight: 500;
      letter-spacing: 0.02em;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .time-slot-time .date {
      font-family: 'Source Serif 4', Georgia, serif;
      font-size: 0.95rem;
      opacity: 0.85;
      font-style: italic;
      background: rgba(255,255,255,0.15);
      padding: 4px 12px;
      border-radius: 20px;
      backdrop-filter: blur(4px);
    }

    .time-slot-meta {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 0.9rem;
    }

    .time-slot-meta .course-count {
      background: rgba(255,255,255,0.2);
      padding: 6px 14px;
      border-radius: 20px;
      font-weight: 500;
      backdrop-filter: blur(4px);
      transition: all var(--anim-fast) var(--ease-out);
    }

    .time-slot-meta .course-count:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    .time-slot-meta .price-range {
      font-family: 'DM Mono', monospace;
      font-weight: 500;
      background: rgba(0,0,0,0.15);
      padding: 6px 14px;
      border-radius: 20px;
    }

    .time-slot-meta .deals-badge {
      background: linear-gradient(135deg, var(--deal), #a83200);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      animation: pulse 2s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(139, 37, 0, 0.4);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.9; transform: scale(1.02); }
    }

    .time-slot-courses {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 14px;
      padding: 20px;
      background: linear-gradient(180deg, rgba(244, 241, 232, 0.5) 0%, transparent 100%);
    }

    .course-chip {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: white;
      border-radius: 8px;
      border: 2px solid var(--border-light);
      transition: all 0.2s ease;
    }

    .course-chip:hover {
      border-color: var(--primary);
      transform: translateX(4px);
    }

    .course-chip-name {
      flex: 1;
      font-family: 'Playfair Display', Georgia, serif;
      font-weight: 600;
      font-size: 1rem;
      color: var(--text);
      text-decoration: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .course-chip-name:hover {
      color: var(--primary);
      text-decoration: underline;
    }

    .course-chip-price {
      font-family: 'DM Mono', monospace;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--primary);
      min-width: 50px;
      text-align: right;
    }

    .chip-buttons {
      display: flex;
      gap: 6px;
    }

    .chip-book, .chip-call {
      padding: 8px 14px;
      background: var(--primary);
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      transition: all 0.2s ease;
    }

    .chip-book:hover, .chip-call:hover {
      background: var(--primary-dark);
    }

    @media (max-width: 768px) {
      .time-slot-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .time-slot-courses {
        grid-template-columns: 1fr;
      }
      .course-chip-name {
        font-size: 0.9rem;
      }
    }

    /* Legacy single card styles */
    .tee-time-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      display: grid;
      grid-template-columns: 100px 1fr auto auto;
      gap: 20px;
      align-items: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .tee-time-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

    .time-block { text-align: center; }
    .time-block .time { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
    .time-block .date { font-size: 0.8rem; color: var(--text-muted); }

    .course-info h3 { font-size: 1.05rem; font-weight: 600; margin-bottom: 4px; }
    .course-info h3 a { color: var(--primary); text-decoration: none; cursor: pointer; }
    .course-info h3 a:hover { text-decoration: underline; }
    .course-info .location { font-size: 0.85rem; color: var(--text-muted); }
    .course-info .badges { display: flex; gap: 6px; margin-top: 6px; flex-wrap: wrap; }
    .badge { font-size: 0.75rem; padding: 3px 8px; border-radius: 4px; background: #e8f5e9; color: var(--primary); }
    .badge.holes { background: #e3f2fd; color: #1565c0; }
    .badge.players { background: #f3e5f5; color: #7b1fa2; }
    .badge.rating { background: #fff8e1; color: #f57c00; display: flex; align-items: center; gap: 3px; }

    .price-block { text-align: right; }
    .price-block .price { font-size: 1.4rem; font-weight: 700; color: var(--text); }
    .price-block .original-price { font-size: 0.85rem; color: var(--text-muted); text-decoration: line-through; }
    .price-block .deal-tag { font-size: 0.75rem; color: var(--deal); font-weight: 600; }

    .card-buttons {
      display: flex;
      gap: 8px;
    }

    .book-btn, .call-btn {
      padding: 12px 20px;
      background: var(--primary);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition: background 0.2s;
      white-space: nowrap;
    }
    .book-btn:hover, .call-btn:hover { background: var(--primary-light); }

    .loading { text-align: center; padding: 60px 20px; color: var(--text-muted); }
    .loading-spinner {
      width: 40px; height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .no-results { text-align: center; padding: 60px 20px; background: var(--card-bg); border-radius: 12px; }
    .no-results h3 { margin-bottom: 8px; }
    .no-results p { color: var(--text-muted); }

    footer {
      text-align: center;
      padding: 48px 20px;
      color: var(--text-muted);
      font-size: 0.9rem;
      background: var(--card-bg);
      border-top: 4px solid var(--border);
    }
    footer .footer-content { max-width: 600px; margin: 0 auto; }
    footer .footer-content p { margin: 10px 0; }
    footer .footer-content strong { font-family: 'Playfair Display', Georgia, serif; font-size: 1.1rem; }
    footer .footer-regions { font-size: 0.85rem; font-style: italic; }
    footer .footer-regions span { color: var(--primary); font-weight: 600; }
    footer .footer-copy { font-size: 0.8rem; margin-top: 20px !important; }

    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--primary);
      color: white;
      padding: 8px 16px;
      z-index: 10000;
      text-decoration: none;
      border-radius: 0 0 4px 0;
    }
    .skip-link:focus {
      top: 0;
    }

    /* Improved focus states for accessibility */
    a:focus, button:focus, select:focus, input:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    /* Screen reader only content */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(61, 41, 20, 0.7);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }
    .modal-overlay.active { display: flex; justify-content: center; align-items: flex-start; }
    .modal {
      background: var(--card-bg);
      border-radius: 4px;
      max-width: 800px;
      width: 100%;
      margin: 40px auto;
      overflow: hidden;
      border: 4px solid var(--border);
      box-shadow: 0 20px 60px rgba(61, 41, 20, 0.4);
    }
    .modal-header {
      position: relative;
      height: 280px;
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      overflow: hidden;
    }
    .modal-header img { width: 100%; height: 100%; object-fit: cover; }
    .modal-header-overlay {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      padding: 40px 28px 24px;
      background: linear-gradient(transparent, rgba(26, 61, 23, 0.85));
      color: #f4f1e8;
    }
    .modal-header-overlay h2 { font-family: 'Playfair Display', Georgia, serif; font-size: 2rem; margin-bottom: 6px; font-weight: 700; }
    .modal-header-overlay .subtitle { opacity: 0.9; font-style: italic; }
    .modal-close {
      position: absolute;
      top: 16px; right: 16px;
      width: 36px; height: 36px;
      border-radius: 50%;
      background: rgba(0,0,0,0.4);
      color: white;
      border: none;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-close:hover { background: rgba(0,0,0,0.6); }

    .modal-body { padding: 28px; }
    .modal-section { margin-bottom: 32px; }
    .modal-section:last-child { margin-bottom: 0; }
    .modal-section h3 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 2px solid var(--border-light);
      padding-bottom: 10px;
    }

    /* Booking popup styles */
    .external-course-info {
      background: var(--bg-paper);
      border: 2px solid var(--border-light);
      border-radius: 4px;
      padding: 16px;
    }
    .external-course-info .info-row {
      display: flex;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-light);
    }
    .external-course-info .info-row:last-child { border-bottom: none; }
    .external-course-info .info-row .label {
      font-weight: 600;
      color: var(--text-muted);
      min-width: 100px;
      margin-right: 12px;
    }
    .external-course-info .info-row a {
      color: var(--primary);
      text-decoration: none;
    }
    .external-course-info .info-row a:hover { text-decoration: underline; }

    .booking-date-group {
      margin-bottom: 20px;
    }
    .booking-date-group:last-child { margin-bottom: 0; }
    .booking-date-group h4 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--primary);
    }
    .booking-times-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
    }
    .booking-time-slot {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 10px;
      background: var(--bg-paper);
      border: 2px solid var(--border-light);
      border-radius: 4px;
      text-decoration: none;
      color: var(--text);
      transition: all 0.2s ease;
    }
    .booking-time-slot:hover {
      border-color: var(--primary);
      background: linear-gradient(135deg, #e8efe6, #f0f6ed);
      transform: translateY(-2px);
    }
    .booking-time-slot .time {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--primary);
    }
    .booking-time-slot .price {
      font-size: 1rem;
      font-weight: 700;
      color: var(--gold);
      margin: 4px 0;
    }
    .booking-time-slot .details {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .no-times {
      color: var(--text-muted);
      font-style: italic;
      text-align: center;
      padding: 20px;
    }
    .btn-secondary {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    .btn-secondary:hover {
      background: var(--primary);
      color: #f4f1e8;
    }

    /* Compare Modal Styles */
    .compare-btn { margin-left: auto; }
    .compare-modal { max-width: 900px; min-width: min(600px, 95vw); max-height: 90vh; display: flex; flex-direction: column; }
    .compare-header {
      padding: 24px 28px;
      border-bottom: 2px solid var(--border-light);
    }
    .compare-header h2 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.5rem;
      margin-bottom: 16px;
      text-align: center;
    }
    .compare-selectors {
      display: flex;
      align-items: center;
      gap: 16px;
      justify-content: center;
    }
    .compare-selectors select {
      flex: 1;
      max-width: 300px;
      padding: 10px 12px;
      border: 2px solid var(--border-light);
      border-radius: 4px;
      font-size: 0.95rem;
      background: var(--bg-paper);
    }
    .compare-selectors .vs {
      font-family: 'Playfair Display', Georgia, serif;
      font-weight: 700;
      color: var(--text-muted);
    }
    .compare-filters {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    .compare-filters select {
      padding: 8px 12px;
      border: 2px solid var(--border-light);
      border-radius: 4px;
      font-size: 0.85rem;
      background: var(--bg-paper);
    }
    .compare-body { padding: 24px 28px; flex-grow: 1; overflow-y: auto; }
    .compare-placeholder {
      text-align: center;
      color: var(--text-muted);
      font-style: italic;
      padding: 40px;
    }
    .compare-grid {
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    .compare-names-row, .compare-stat-row, .compare-tee-times-row {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
    }
    .compare-stat-row .compare-label {
      text-align: center;
      padding: 12px 8px;
    }
    .compare-column {
      padding: 0 16px;
    }
    .compare-column.left { text-align: center; }
    .compare-column.right { text-align: center; }
    .compare-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 24px;
      flex-wrap: wrap;
    }
    .compare-column.center {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0 12px;
      border-left: 2px solid var(--border-light);
      border-right: 2px solid var(--border-light);
    }
    .compare-course-name {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 8px;
    }
    .compare-course-location {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 16px;
    }
    .compare-row {
      display: contents;
    }
    .compare-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      padding: 12px 0;
      font-weight: 600;
      text-align: center;
    }
    .compare-value {
      padding: 8px 0;
      font-size: 1rem;
      border-bottom: 1px solid var(--border-light);
      text-align: center;
      color: var(--text-muted);
    }
    .compare-value.better {
      color: var(--primary);
      font-weight: 900;
      font-size: 1.25rem;
      background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
      border-radius: 6px;
      padding: 8px 4px;
      position: relative;
    }
    .compare-value.better::after {
      content: ' âœ“';
      font-size: 0.9rem;
    }
    .compare-section-title {
      grid-column: 1 / -1;
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1rem;
      font-weight: 700;
      padding: 16px 0 8px;
      margin-top: 8px;
      border-bottom: 2px solid var(--border-light);
      color: var(--primary);
      text-align: center;
    }
    .compare-tee-times {
      max-height: 200px;
      overflow-y: auto;
    }
    .compare-tee-time {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      font-size: 0.9rem;
      border-bottom: 1px solid var(--border-light);
    }
    .compare-tee-time a {
      color: var(--text);
      text-decoration: none;
    }
    .compare-tee-time a:hover {
      color: var(--primary);
    }
    @media (max-width: 700px) {
      .compare-modal { max-width: 100%; margin: 8px; max-height: 92vh; }
      .compare-header { padding: 12px 16px; }
      .compare-header h2 { font-size: 1.2rem; }
      .compare-selectors { flex-direction: column; gap: 8px; }
      .compare-selectors select { max-width: 100%; font-size: 14px; padding: 10px; }
      .compare-filters { flex-direction: column; gap: 8px; padding: 10px; }
      .compare-filters select, .compare-filters input { font-size: 14px; padding: 8px; }
      .compare-body { padding: 0; overflow-y: auto; }

      .compare-names-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        padding: 12px 8px;
        border-bottom: 2px solid var(--border);
        background: var(--bg);
      }
      .compare-names-row .compare-column.center { display: none; }
      .compare-names-row .compare-column { padding: 0 4px; }
      .compare-course-name { font-size: 0.95rem !important; font-weight: 700; line-height: 1.2; }
      .compare-course-location { font-size: 0.7rem !important; color: var(--text-muted); }

      .compare-stat-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-areas:
          "label label"
          "val1 val2";
      }
      .compare-stat-row .compare-label {
        grid-area: label;
        text-align: center;
        background: var(--bg);
        padding: 8px 0 4px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        border-top: 1px solid var(--border-light);
      }
      .compare-stat-row .compare-value {
        text-align: center;
        padding: 6px 4px 10px;
        font-size: 1.15rem;
        font-weight: 500;
        color: var(--text-muted);
      }
      .compare-stat-row .compare-value.better {
        font-weight: 900;
        font-size: 1.3rem;
        color: var(--primary);
        background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
        border-radius: 6px;
        margin: 2px;
      }
      .compare-stat-row .compare-value:nth-child(1) { grid-area: val1; }
      .compare-stat-row .compare-value:nth-child(3) { grid-area: val2; }

      .compare-section-title {
        font-size: 0.65rem !important;
        text-align: center;
        padding: 8px 0 !important;
        background: var(--primary);
        color: white;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
      }

      .compare-tee-times-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 4px;
        padding: 8px;
      }
      .compare-tee-times-row .compare-column.center { display: none; }
      .compare-tee-times-row .compare-column { padding: 0 !important; }
      .compare-tee-time { font-size: 0.75rem !important; padding: 4px !important; }

      .compare-actions {
        padding: 12px;
        gap: 8px;
      }
      .compare-actions .btn { font-size: 0.8rem; padding: 8px 12px; }
    }

    .course-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 14px;
    }
    .course-stat {
      background: var(--bg-paper);
      padding: 14px;
      border-radius: 4px;
      text-align: center;
      border: 2px solid var(--border-light);
    }
    .course-stat .value { font-family: 'Playfair Display', Georgia, serif; font-size: 1.4rem; font-weight: 800; color: var(--primary); }
    .course-stat .label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

    .course-record {
      background: linear-gradient(135deg, #fdf8e8, #faf3df);
      padding: 18px;
      border-radius: 4px;
      border-left: 4px solid var(--gold);
      border: 2px solid var(--border-light);
      border-left: 4px solid var(--gold);
    }
    .course-record .score { font-family: 'Playfair Display', Georgia, serif; font-size: 2.2rem; font-weight: 800; color: var(--gold); }
    .course-record .holder { font-weight: 600; margin-top: 6px; }
    .course-record .details { font-size: 0.85rem; color: var(--text-muted); margin-top: 6px; font-style: italic; }

    .tournament-history { display: flex; flex-direction: column; gap: 14px; }
    .tournament-item {
      background: linear-gradient(135deg, #e8efe6, #f0f6ed);
      padding: 16px 18px;
      border-radius: 4px;
      border: 2px solid var(--border-light);
      border-left: 4px solid var(--primary);
    }
    .tournament-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .tournament-name { font-family: 'Playfair Display', Georgia, serif; font-weight: 700; color: var(--primary-dark); font-size: 1rem; }
    .tournament-year { background: var(--primary); color: #f4f1e8; padding: 4px 12px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; }
    .tournament-winner { display: flex; justify-content: space-between; align-items: center; }
    .winner-name { font-weight: 700; font-size: 1.15rem; }
    .winner-score { font-family: 'Playfair Display', Georgia, serif; font-weight: 800; color: var(--gold); font-size: 1.15rem; }
    .tournament-notes { font-size: 0.8rem; color: var(--text-muted); margin-top: 8px; font-style: italic; }

    .photos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
    }
    .photo-card {
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }
    .photo-card img { width: 100%; height: 100px; object-fit: cover; }
    .photo-card .year {
      position: absolute;
      bottom: 4px; right: 4px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.7rem;
    }

    .food-highlight {
      display: flex;
      gap: 16px;
      background: var(--bg);
      padding: 16px;
      border-radius: 10px;
      align-items: center;
    }
    .food-highlight img { width: 100px; height: 80px; border-radius: 8px; object-fit: cover; }
    .food-highlight .food-info h4 { font-weight: 600; margin-bottom: 4px; }
    .food-highlight .food-info p { font-size: 0.85rem; color: var(--text-muted); }
    .food-highlight .food-rating { display: flex; align-items: center; gap: 4px; margin-top: 6px; color: var(--gold); font-weight: 600; }

    .reviews-list { display: flex; flex-direction: column; gap: 12px; }
    .review-card { background: var(--bg); padding: 14px; border-radius: 10px; }
    .review-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
    .review-author { font-weight: 600; }
    .review-rating { color: var(--gold); }
    .review-text { font-size: 0.9rem; color: var(--text-muted); }
    .review-time { font-size: 0.75rem; color: #999; margin-top: 6px; }

    .rating-comparison {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .rating-box {
      text-align: center;
      padding: 12px 20px;
      background: var(--bg);
      border-radius: 8px;
    }
    .rating-box .value { font-size: 2rem; font-weight: 800; color: var(--gold); }
    .rating-box .label { font-size: 0.75rem; color: var(--text-muted); }
    .rating-trend { font-size: 0.85rem; color: var(--text-muted); flex: 1; }
    .rating-trend .up { color: var(--success); }
    .rating-trend .down { color: var(--deal); }

    .contact-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }
    .contact-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      background: var(--bg);
      border-radius: 8px;
      text-decoration: none;
      color: var(--text);
      transition: background 0.2s;
    }
    .contact-item:hover { background: #e8f5e9; }
    .contact-item svg { flex-shrink: 0; color: var(--primary); }
    .contact-item .label { font-size: 0.75rem; color: var(--text-muted); }
    .contact-item .value { font-weight: 500; }

    .facilities-grid {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .facility-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    .facility-badge.available { background: #e8f5e9; color: var(--primary); }
    .facility-badge.unavailable { background: #f5f5f5; color: #999; text-decoration: line-through; }

    .weather-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      border-radius: 10px;
      text-decoration: none;
      color: var(--text);
      transition: transform 0.2s;
    }
    .weather-link:hover { transform: translateY(-2px); }
    .weather-link svg { color: #1976d2; }
    .weather-link .weather-text { flex: 1; }
    .weather-link .weather-text strong { display: block; color: #1976d2; }
    .weather-link .weather-text span { font-size: 0.85rem; color: var(--text-muted); }

    @media (max-width: 768px) {
      .tee-time-card { grid-template-columns: 1fr; gap: 12px; }
      .time-block { text-align: left; display: flex; align-items: baseline; gap: 10px; }
      .price-block { text-align: left; }
      .filters-grid { grid-template-columns: 1fr 1fr; }
      .quick-actions-header { flex-direction: column; align-items: stretch; }
      .next-available-btn { justify-content: center; }
      .modal-header { height: 180px; }
      .food-highlight { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="skip-link" aria-label="Skip to main content">Skip to main content</a>

  <header role="banner">
    <div class="container header-content">
      <h1>Bay Area Golf</h1>
      <nav class="header-nav">
        <a href="/" class="nav-btn">Home</a>
        <a href="/app.html" class="nav-btn active">Tee Times</a>
        <a href="/courses.html" class="nav-btn">Courses</a>
        <button class="nav-btn nav-btn-ai" onclick="toggleGolfChat()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
          </svg>
          AI Concierge
        </button>
      </nav>
    </div>
  </header>

  <main class="container" id="main-content" role="main">
    <!-- Tee Times Section -->
    <section id="tee-times-tab" class="tab-content active">
      <h2 class="sr-only">Available Golf Tee Times in Bay Area</h2>

      <div class="filters" style="margin-top: 24px;">
      <!-- Required Region + Date Selection -->
      <div class="required-filters" style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap; margin-bottom: 16px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
        <div class="filter-group" style="margin: 0;">
          <label for="region-select" style="font-weight: 600; color: #1a472a;">Region <span style="color: #dc3545;">*</span></label>
          <select id="region-select" onchange="onFilterChange()" style="min-width: 160px;">
            <option value="">Select a region...</option>
            <option value="San Francisco">San Francisco</option>
            <option value="South Bay">South Bay</option>
            <option value="East Bay">East Bay</option>
            <option value="North Bay">North Bay</option>
            <option value="Napa">Napa</option>
          </select>
        </div>
        <div class="filter-group" style="margin: 0;">
          <label for="date-select" style="font-weight: 600; color: #1a472a;">Date <span style="color: #dc3545;">*</span></label>
          <select id="date-select" onchange="onFilterChange()" style="min-width: 180px;">
            <option value="">Select a date...</option>
            <!-- Dates will be generated by JavaScript -->
          </select>
        </div>
        <button class="btn" id="search-btn" onclick="searchTeeTimes()" disabled style="margin-top: 20px; opacity: 0.5; cursor: not-allowed;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          Search Tee Times
        </button>
      </div>

      <div class="filter-tabs" style="display: none;">
        <!-- Legacy tabs hidden - using required filters above -->
      </div>
      <!-- Week Date Picker (hidden - using dropdown above) -->
      <div class="week-picker" id="week-picker" style="display: none;">
        <!-- Days will be generated by JavaScript -->
      </div>

      <div class="filters-grid">
        <div class="filter-group">
          <label for="course">Course</label>
          <select id="course">
            <option value="">All Courses</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="min-time">After</label>
          <select id="min-time">
            <option value="">Any time</option>
            <option value="06:00">6:00 AM</option>
            <option value="07:00">7:00 AM</option>
            <option value="08:00">8:00 AM</option>
            <option value="09:00">9:00 AM</option>
            <option value="10:00">10:00 AM</option>
            <option value="11:00">11:00 AM</option>
            <option value="12:00">12:00 PM</option>
            <option value="14:00">2:00 PM</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="max-price">Max Price</label>
          <select id="max-price">
            <option value="">Any price</option>
            <option value="30">Under $30</option>
            <option value="50">Under $50</option>
            <option value="75">Under $75</option>
            <option value="100">Under $100</option>
            <option value="150">Under $150</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="players">Players</label>
          <select id="players">
            <option value="">Any</option>
            <option value="2">2+</option>
            <option value="3">3+</option>
            <option value="4">4</option>
          </select>
        </div>
        <button class="btn" onclick="searchTeeTimes()">Filter</button>
      </div>
    </div>

    <div class="results-header">
      <span class="results-count" id="results-count"></span>
      <div class="sort-controls">
        <label>Sort:</label>
        <select id="sort-by" onchange="searchTeeTimes()">
          <option value="datetime">Time</option>
          <option value="price">Price</option>
          <option value="course_name">Course</option>
          <option value="avg_rating">Rating</option>
        </select>
        <select id="sort-order" onchange="searchTeeTimes()">
          <option value="ASC">Asc</option>
          <option value="DESC">Desc</option>
        </select>
      </div>
    </div>

    <div id="results" class="tee-times-grid" aria-live="polite" aria-busy="true" role="region" aria-label="Tee time search results">
        <div class="loading" role="status">
          <div class="loading-spinner" aria-hidden="true"></div>
          <p>Loading tee times...</p>
        </div>
      </div>
    </section>

  </main>

  <footer role="contentinfo">
    <div class="container">
      <div class="footer-content">
        <p><strong>Bay Area Golf Tee Times</strong> - Your guide to booking tee times at public golf courses in the San Francisco Bay Area.</p>
        <p class="footer-regions">Covering golf courses in: <span>San Francisco</span> | <span>South Bay</span> | <span>East Bay</span> | <span>North Bay</span> | <span>Napa</span></p>
        <p class="footer-copy">&copy; 2026 Bay Area Golf Tee Times. Find the best golf deals in Northern California.</p>
      </div>
    </div>
  </footer>

  <!-- Noscript fallback for SEO -->
  <noscript>
    <div style="padding: 40px; text-align: center; background: #fff3cd; color: #856404;">
      <h2>Bay Area Golf Tee Times</h2>
      <p>JavaScript is required to use this tee time search tool.</p>
      <p>Find and book golf tee times across 40+ public courses in San Francisco, South Bay, East Bay, North Bay, and Napa.</p>
      <p>Popular courses include: Presidio Golf Course, TPC Harding Park, Lincoln Park Golf Course, Sharp Park Golf Course, Crystal Springs Golf Course, Palo Alto Municipal Golf Course, and many more.</p>
      <p>Please enable JavaScript or visit individual course websites directly to book your tee time.</p>
    </div>
  </noscript>

  <!-- Compare Courses Modal -->
  <div class="modal-overlay" id="compare-modal" onclick="closeCompareModalOnOverlay(event)" role="dialog" aria-modal="true">
    <div class="modal compare-modal">
      <button class="modal-close" onclick="closeCompareModal()" aria-label="Close comparison">&times;</button>
      <div class="compare-header">
        <h2>Compare Courses</h2>
        <div class="compare-selectors">
          <select id="compare-course-1" onchange="updateComparison()">
            <option value="">Select first course...</option>
          </select>
          <span class="vs">vs</span>
          <select id="compare-course-2" onchange="updateComparison()">
            <option value="">Select second course...</option>
          </select>
        </div>
        <div class="compare-filters" id="compare-filters" style="display: none;">
          <select id="compare-date-filter" onchange="filterCompareTeeTimes()">
            <option value="">All Days</option>
          </select>
          <select id="compare-time-filter" onchange="filterCompareTeeTimes()">
            <option value="">Any Time</option>
            <option value="morning">Morning (before 10am)</option>
            <option value="midday">Midday (10am-2pm)</option>
            <option value="afternoon">Afternoon (after 2pm)</option>
          </select>
          <select id="compare-price-filter" onchange="filterCompareTeeTimes()">
            <option value="">Any Price</option>
            <option value="50">Under $50</option>
            <option value="75">Under $75</option>
            <option value="100">Under $100</option>
          </select>
        </div>
      </div>
      <div class="compare-body" id="compare-body">
        <p class="compare-placeholder">Select two courses above to compare</p>
      </div>
    </div>
  </div>

  <!-- Course Detail Modal -->
  <div class="modal-overlay" id="course-modal" onclick="closeModalOnOverlay(event)" role="dialog" aria-modal="true" aria-labelledby="modal-course-name" aria-describedby="modal-course-location">
    <div class="modal">
      <div class="modal-header" id="modal-header">
        <img id="modal-hero-img" src="" alt="Golf course aerial view">
        <div class="modal-header-overlay">
          <h2 id="modal-course-name"></h2>
          <div class="subtitle" id="modal-course-location"></div>
        </div>
        <button class="modal-fav-btn" id="modal-fav-btn" onclick="toggleFavoriteFromModal(event)">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e91e63" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
        </button>
        <button class="modal-close" onclick="closeModal()" aria-label="Close course details">&times;</button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- Content loaded dynamically -->
      </div>
    </div>
  </div>

  <script>
    const API_BASE = '/api';
    let isNextAvailableMode = true; // Default to showing next available tee times

    // Helper to get today's date in Pacific timezone
    function getPacificDate() {
      const now = new Date();
      const pst = new Date(now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
      const year = pst.getFullYear();
      const month = String(pst.getMonth() + 1).padStart(2, '0');
      const day = String(pst.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // Helper to get current time in Pacific timezone (HH:MM format)
    function getPacificTime() {
      const now = new Date();
      const pst = new Date(now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
      const hours = String(pst.getHours()).padStart(2, '0');
      const mins = String(pst.getMinutes()).padStart(2, '0');
      return `${hours}:${mins}`;
    }
    let selectedRegion = '';
    let selectedRegions = []; // Multi-select regions
    let directoryRegion = '';
    let coursesData = [];
    let currentCourseId = null;

    // Favorites management
    function getFavorites() {
      try {
        return JSON.parse(localStorage.getItem('golfFavorites') || '[]');
      } catch (e) { return []; }
    }

    function saveFavorites(favorites) {
      localStorage.setItem('golfFavorites', JSON.stringify(favorites));
    }

    function isFavorite(courseId) {
      return getFavorites().includes(courseId);
    }

    function toggleFavorite(courseId, event) {
      if (event) event.stopPropagation();
      const favorites = getFavorites();
      const index = favorites.indexOf(courseId);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        favorites.push(courseId);
      }
      saveFavorites(favorites);
      updateFavoriteButtons(courseId);
      // If we're filtering by favorites, refresh the views
      if (selectedRegion === 'favorites') searchTeeTimes();
      if (directoryRegion === 'favorites') renderCoursesDirectory();
    }

    function toggleFavoriteFromModal(event) {
      if (currentCourseId) {
        toggleFavorite(currentCourseId, event);
      }
    }

    function updateFavoriteButtons(courseId) {
      const isFav = isFavorite(courseId);
      // Update directory card button
      const cardBtn = document.querySelector(`.course-card[data-id="${courseId}"] .fav-btn`);
      if (cardBtn) cardBtn.classList.toggle('favorited', isFav);
      // Update modal button
      if (currentCourseId === courseId) {
        document.getElementById('modal-fav-btn').classList.toggle('favorited', isFav);
      }
    }

    // Tab switching
    // SEO-friendly page titles
    const pageTitles = {
      'tee-times': 'Bay Area Golf Tee Times | Find & Book Tee Times at 40+ Public Courses',
      'courses': 'Bay Area Golf Courses Directory | 40+ Public Courses in SF Bay Area'
    };

    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-selected', 'false');
      });
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));

      const activeBtn = document.querySelector(`.tab-btn[onclick="switchTab('${tabName}')"]`);
      activeBtn.classList.add('active');
      activeBtn.setAttribute('aria-selected', 'true');
      document.getElementById(`${tabName}-tab`).classList.add('active');

      // Update document title for SEO
      document.title = pageTitles[tabName] || pageTitles['tee-times'];

      // Update URL hash for bookmarking (SEO friendly)
      history.replaceState(null, '', `#${tabName}`);

      if (tabName === 'courses') {
        renderCoursesDirectory();
      }
    }

    // Selected date for week picker
    let selectedDate = getPacificDate();

    // Generate 7-day week picker
    function generateWeekPicker() {
      // Generate date dropdown options instead of week picker buttons
      const dateSelect = document.getElementById('date-select');
      if (!dateSelect) return;

      const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

      let html = '<option value="">Select a date...</option>';

      for (let i = 0; i < 7; i++) {
        const date = new Date();
        const pst = new Date(date.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
        pst.setDate(pst.getDate() + i);

        const year = pst.getFullYear();
        const month = String(pst.getMonth() + 1).padStart(2, '0');
        const day = String(pst.getDate()).padStart(2, '0');
        const dateStr = `${year}-${month}-${day}`;

        const dayName = i === 0 ? 'Today' : (i === 1 ? 'Tomorrow' : dayNames[pst.getDay()]);
        const label = `${dayName}, ${monthNames[pst.getMonth()]} ${pst.getDate()}`;

        html += `<option value="${dateStr}">${label}</option>`;
      }

      dateSelect.innerHTML = html;
    }

    // Handle required filter changes
    function onFilterChange() {
      const regionSelect = document.getElementById('region-select');
      const dateSelect = document.getElementById('date-select');
      const searchBtn = document.getElementById('search-btn');

      const hasRegion = regionSelect && regionSelect.value;
      const hasDate = dateSelect && dateSelect.value;

      if (searchBtn) {
        if (hasRegion && hasDate) {
          searchBtn.disabled = false;
          searchBtn.style.opacity = '1';
          searchBtn.style.cursor = 'pointer';
        } else {
          searchBtn.disabled = true;
          searchBtn.style.opacity = '0.5';
          searchBtn.style.cursor = 'not-allowed';
        }
      }

      // Update selected values
      if (hasRegion) selectedRegion = regionSelect.value;
      if (hasDate) selectedDate = dateSelect.value;
    }

    // Handle day selection (legacy - kept for compatibility)
    function selectDay(dateStr) {
      selectedDate = dateStr;
      const dateSelect = document.getElementById('date-select');
      if (dateSelect) dateSelect.value = dateStr;
      onFilterChange();
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Generate date picker dropdown
      generateWeekPicker();
      loadCourses();

      // Default to no selection - require user input
      selectedRegion = '';
      selectedDate = '';
      isNextAvailableMode = false;

      // Show initial prompt instead of loading
      const resultsDiv = document.getElementById('results');
      if (resultsDiv) {
        resultsDiv.innerHTML = `
          <div style="text-align: center; padding: 60px 20px; color: #666;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#2d5a27" stroke-width="1.5" style="margin-bottom: 16px;">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <h3 style="margin: 0 0 8px; color: #1a472a;">Select a Region and Date</h3>
            <p style="margin: 0; max-width: 400px; margin: 0 auto;">Choose a region and date above to find available tee times at Bay Area golf courses.</p>
          </div>
        `;
      }

      // Handle URL hash for deep linking (SEO)
      const hash = window.location.hash.replace('#', '');
      if (hash === 'courses') {
        switchTab('courses');
      }

      // Handle URL params for pre-selecting filters
      const urlParams = new URLSearchParams(window.location.search);
      const regionParam = urlParams.get('region');
      const dateParam = urlParams.get('date');

      if (regionParam) {
        const regionSelect = document.getElementById('region-select');
        if (regionSelect) regionSelect.value = regionParam;
      }
      if (dateParam) {
        const dateSelect = document.getElementById('date-select');
        if (dateSelect) dateSelect.value = dateParam;
      }
      if (regionParam || dateParam) {
        onFilterChange();
        // Auto-search if both provided via URL
        if (regionParam && dateParam) searchTeeTimes();
      }

      // Handle course query param - open course detail modal
      const courseParam = urlParams.get('course');
      if (courseParam) {
        setTimeout(() => openCourseDetail(parseInt(courseParam)), 500);
      }

      // Set default time to 7am
      document.getElementById('min-time').value = '07:00';
    });

    // Handle browser back/forward for hash changes
    window.addEventListener('hashchange', () => {
      const hash = window.location.hash.replace('#', '');
      if (hash === 'courses' || hash === 'tee-times') {
        switchTab(hash);
      }
    });

    async function loadCourses() {
      try {
        const res = await fetch(`${API_BASE}/courses?_t=${Date.now()}`);
        coursesData = await res.json();
        updateCourseDropdown();
      } catch (e) { console.error('Error loading courses:', e); }
    }

    function updateCourseDropdown() {
      const select = document.getElementById('course');
      select.innerHTML = '<option value="">All Courses</option>';
      let filtered = coursesData;

      // Filter by multi-select regions first
      if (selectedRegions.length > 0) {
        filtered = coursesData.filter(c => selectedRegions.includes(c.region));
      } else if (selectedRegion && selectedRegion !== 'favorites' && selectedRegion !== 'staff_picks') {
        filtered = coursesData.filter(c => c.region === selectedRegion);
      }

      // Then apply category filters
      if (selectedRegion === 'favorites') {
        const favs = getFavorites();
        filtered = filtered.filter(c => favs.includes(c.id));
      } else if (selectedRegion === 'staff_picks') {
        filtered = filtered.filter(c => c.is_staff_pick);
      }

      filtered.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.textContent = `${c.name} (${c.city})`;
        select.appendChild(opt);
      });
    }

    function toggleNextAvailable() {
      isNextAvailableMode = !isNextAvailableMode;
      const btn = document.getElementById('next-available-btn');
      if (isNextAvailableMode) {
        if (btn) {
          btn.classList.add('active');
          btn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> Showing All Next Available`;
        }
        // Deselect all day buttons
        document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
      } else {
        if (btn) {
          btn.classList.remove('active');
          btn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> Next Available Tee Times`;
        }
        // Re-select current day
        document.querySelectorAll('.day-btn').forEach(b => {
          b.classList.toggle('active', b.dataset.date === selectedDate);
        });
      }
      searchTeeTimes();
    }

    // New filter tab function
    function selectFilterTab(filter) {
      selectedRegion = filter === 'all' ? '' : filter;
      // Update main filter tabs (not region tabs)
      document.querySelectorAll('.filter-tab[data-filter]').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.filter === filter);
      });
      updateCourseDropdown();
      searchTeeTimes();
    }

    // Toggle region selection (multi-select)
    function toggleRegion(region) {
      const idx = selectedRegions.indexOf(region);
      if (idx > -1) {
        selectedRegions.splice(idx, 1);
      } else {
        selectedRegions.push(region);
      }
      // Update region tab buttons
      document.querySelectorAll('.filter-tab.region-tab').forEach(tab => {
        tab.classList.toggle('active', selectedRegions.includes(tab.dataset.region));
      });
      updateCourseDropdown();
      searchTeeTimes();
    }

    function selectRegion(region) {
      selectedRegion = region;
      document.querySelectorAll('#tee-times-tab .region-chip').forEach(chip => {
        chip.classList.toggle('active', chip.dataset.region === region);
      });
      updateCourseDropdown();
      searchTeeTimes();
    }

    function filterDirectoryByRegion(region) {
      directoryRegion = region;
      document.querySelectorAll('#courses-tab .region-chip').forEach(chip => {
        chip.classList.toggle('active', chip.dataset.dirRegion === region);
      });
      renderCoursesDirectory();
    }

    function renderCoursesDirectory() {
      const container = document.getElementById('courses-directory');
      let filtered = [...coursesData];

      if (directoryRegion === 'favorites') {
        const favs = getFavorites();
        filtered = filtered.filter(c => favs.includes(c.id));
      } else if (directoryRegion) {
        filtered = filtered.filter(c => c.region === directoryRegion);
      }

      // Sort based on dropdown selection
      const sortBy = document.getElementById('directory-sort')?.value || 'name';
      if (sortBy === 'rating') {
        filtered.sort((a, b) => (b.avg_rating || 0) - (a.avg_rating || 0));
      } else if (sortBy === 'holes') {
        filtered.sort((a, b) => (b.holes || 0) - (a.holes || 0));
      } else {
        filtered.sort((a, b) => a.name.localeCompare(b.name));
      }

      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="no-results" style="grid-column: 1/-1;">
            <h3>${directoryRegion === 'favorites' ? 'No favorites yet' : 'No courses found'}</h3>
            <p>${directoryRegion === 'favorites' ? 'Click the heart icon on any course to add it to your favorites.' : 'Try selecting a different region.'}</p>
          </div>
        `;
        return;
      }

      container.innerHTML = filtered.map(course => {
        const isFav = isFavorite(course.id);
        const imgUrl = course.photo_url || `https://picsum.photos/seed/${course.id}/400/200`;
        const altText = `${course.name} golf course in ${course.city}, ${course.region} - ${course.holes} hole public golf course`;
        return `
          <article class="course-card" data-id="${course.id}" onclick="openCourseDetail(${course.id})" itemscope itemtype="https://schema.org/GolfCourse">
            <div class="course-card-img">
              <img src="${imgUrl}" alt="${altText}" loading="lazy" itemprop="image">
            </div>
            <div class="course-card-body">
              <div class="course-card-header">
                <h3 itemprop="name">${course.name}</h3>
                <button class="fav-btn ${isFav ? 'favorited' : ''}" onclick="toggleFavorite(${course.id}, event)" title="${isFav ? 'Remove from favorites' : 'Add to favorites'}">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#e91e63" stroke-width="2">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                  </svg>
                </button>
              </div>
              <address class="location" itemprop="address" itemscope itemtype="https://schema.org/PostalAddress">
                <span itemprop="addressLocality">${course.city}</span>, <span itemprop="addressRegion">${course.region}</span>
              </address>
              <div class="course-meta">
                <span class="meta-item"><strong>${course.holes}</strong> holes</span>
                ${course.par ? `<span class="meta-item">Par <strong>${course.par}</strong></span>` : ''}
                ${course.yardage ? `<span class="meta-item"><strong>${course.yardage.toLocaleString()}</strong> yards</span>` : ''}
              </div>
              <div class="course-card-footer">
                <span class="tee-times-count">Book tee times at ${course.name}</span>
                ${course.avg_rating ? `<span class="rating-display" itemprop="aggregateRating" itemscope itemtype="https://schema.org/AggregateRating"><span itemprop="ratingValue">${course.avg_rating.toFixed(1)}</span> â˜…</span>` : ''}
              </div>
            </div>
          </article>
        `;
      }).join('');
    }

    let activeQuickFilter = null;

    function applyQuickFilter(filter) {
      // Toggle filter
      if (activeQuickFilter === filter) {
        activeQuickFilter = null;
        // Reset to defaults
        document.getElementById('sort-by').value = 'datetime';
        document.getElementById('sort-order').value = 'ASC';
      } else {
        activeQuickFilter = filter;
        // Apply filter settings
        if (filter === 'solo') {
          document.getElementById('sort-by').value = 'datetime';
          document.getElementById('sort-order').value = 'ASC';
        } else if (filter === 'cheapest') {
          document.getElementById('sort-by').value = 'price';
          document.getElementById('sort-order').value = 'ASC';
        } else if (filter === 'closest') {
          document.getElementById('sort-by').value = 'datetime';
          document.getElementById('sort-order').value = 'ASC';
        }
      }

      // Update button states
      document.querySelectorAll('.quick-filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      if (activeQuickFilter) {
        document.getElementById('filter-' + activeQuickFilter).classList.add('active');
      }

      // Re-search
      searchTeeTimes();
    }

    async function searchTeeTimes(autoAdvanceDate = true) {
      const resultsEl = document.getElementById('results');

      // Get required filter values
      const regionSelect = document.getElementById('region-select');
      const dateSelect = document.getElementById('date-select');
      const reqRegion = regionSelect ? regionSelect.value : '';
      const reqDate = dateSelect ? dateSelect.value : '';

      // Require both region and date
      if (!reqRegion || !reqDate) {
        resultsEl.innerHTML = `
          <div style="text-align: center; padding: 60px 20px; color: #666;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#2d5a27" stroke-width="1.5" style="margin-bottom: 16px;">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <h3 style="margin: 0 0 8px; color: #1a472a;">Select a Region and Date</h3>
            <p style="margin: 0; max-width: 400px; margin: 0 auto;">Choose a region and date above to find available tee times at Bay Area golf courses.</p>
          </div>
        `;
        return;
      }

      // Update state
      selectedRegion = reqRegion;
      selectedDate = reqDate;

      resultsEl.setAttribute('aria-busy', 'true');
      resultsEl.innerHTML = `<div class="loading" role="status"><div class="loading-spinner" aria-hidden="true"></div><p>Searching for tee times...</p></div>`;

      const params = new URLSearchParams();
      // Always use date mode (not next_available) with required filters
      params.set('date', selectedDate);
      params.set('region', selectedRegion);
      const course = document.getElementById('course').value;
      if (course) params.set('course_id', course);
      const minTime = document.getElementById('min-time').value;
      if (minTime) params.set('min_time', minTime);
      const maxPrice = document.getElementById('max-price').value;
      if (maxPrice) params.set('max_price', maxPrice);
      const players = document.getElementById('players').value;
      if (players) params.set('players', players);
      params.set('sort_by', document.getElementById('sort-by').value);
      params.set('sort_order', document.getElementById('sort-order').value);
      params.set('limit', '200');

      try {
        const res = await fetch(`${API_BASE}/tee-times?${params}&_t=${Date.now()}`);

        // Handle API errors
        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          resultsEl.innerHTML = `<div class="no-results"><h3>Error</h3><p>${errorData.error || 'Please select a region and date.'}</p></div>`;
          resultsEl.setAttribute('aria-busy', 'false');
          return;
        }

        let teeTimes = await res.json();

        document.getElementById('results-count').textContent = `${teeTimes.length} tee times found in ${selectedRegion}`;

        if (teeTimes.length === 0) {
          resultsEl.innerHTML = `<div class="no-results"><h3>No tee times found</h3><p>Try a different date or region.</p></div>`;
          resultsEl.setAttribute('aria-busy', 'false');
          return;
        }
        resultsEl.innerHTML = renderGroupedTeeTimes(teeTimes);
        resultsEl.setAttribute('aria-busy', 'false');
      } catch (e) {
        console.error('Error:', e);
        resultsEl.innerHTML = `<div class="no-results"><h3>Error loading</h3><p>Please try again.</p></div>`;
        resultsEl.setAttribute('aria-busy', 'false');
      }
    }

    function renderGroupedTeeTimes(teeTimes) {
      // Group by date + time
      const grouped = {};
      teeTimes.forEach(tt => {
        const key = `${tt.date}|${tt.time}`;
        if (!grouped[key]) {
          grouped[key] = { date: tt.date, time: tt.time, courses: [] };
        }
        grouped[key].courses.push(tt);
      });

      // Sort by datetime
      const sortedGroups = Object.values(grouped).sort((a, b) => {
        const aKey = `${a.date} ${a.time}`;
        const bKey = `${b.date} ${b.time}`;
        return aKey.localeCompare(bKey);
      });

      return sortedGroups.map(group => {
        const time = formatTime(group.time);
        const date = formatDate(group.date);
        const courseCount = group.courses.length;
        const minPrice = Math.min(...group.courses.map(c => c.price || 999));
        const maxPrice = Math.max(...group.courses.map(c => c.price || 0));
        const priceRange = minPrice === maxPrice ? `$${minPrice}` : `$${minPrice}-$${maxPrice}`;
        return `
          <div class="time-slot-card">
            <div class="time-slot-header">
              <div class="time-slot-time">
                <span class="time">${time}</span>
                <span class="date">${date}</span>
              </div>
              <div class="time-slot-meta">
                <span class="course-count">${courseCount} course${courseCount > 1 ? 's' : ''}</span>
                <span class="price-range">${priceRange}</span>
              </div>
            </div>
            <div class="time-slot-courses">
              ${group.courses.map(tt => renderCourseChip(tt)).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    function renderCourseChip(tt) {
      const price = tt.price ? `$${Math.round(tt.price)}` : '--';
      const course = coursesData.find(c => c.id === tt.course_id) || {};
      const bookingUrl = course.booking_url || `/course/${course.slug || tt.course_id}`;
      const phoneNumber = course.phone_number ? course.phone_number.replace(/[^\d+]/g, '') : '';

      return `
        <div class="course-chip">
          <a href="/course/${course.slug || tt.course_id}" class="course-chip-name">${tt.course_name}</a>
          <span class="course-chip-price">${price}</span>
          <div class="chip-buttons">
            <a href="${bookingUrl}" target="_blank" class="chip-book" onclick="trackBookClick(${tt.course_id}, '${tt.course_name.replace(/'/g, "\\'")}')">Book</a>
            ${phoneNumber ? `<a href="tel:${phoneNumber}" class="chip-call" onclick="trackCallClick(${tt.course_id}, '${tt.course_name.replace(/'/g, "\\'")}')">Call</a>` : ''}
          </div>
        </div>
      `;
    }

    function renderTeeTime(tt) {
      const time = formatTime(tt.time);
      const date = formatDate(tt.date);
      const price = tt.price ? `$${Math.round(tt.price)}` : '--';
      const course = coursesData.find(c => c.id === tt.course_id) || {};
      const rating = course.avg_rating ? course.avg_rating.toFixed(1) : null;
      const bookingUrl = course.booking_url || `/course/${course.slug || tt.course_id}`;
      const phoneNumber = course.phone_number ? course.phone_number.replace(/[^\d+]/g, '') : '';

      return `
        <div class="tee-time-card">
          <div class="time-block">
            <div class="time">${time}</div>
            <div class="date">${date}</div>
          </div>
          <div class="course-info">
            <h3><a onclick="openCourseDetail(${tt.course_id})">${tt.course_name}</a></h3>
            <div class="location">${tt.city}, ${tt.region}</div>
            <div class="badges">
              <span class="badge holes">${tt.holes || 18}H</span>
              ${tt.players ? `<span class="badge players">${tt.players} spots</span>` : ''}
              ${rating ? `<span class="badge rating">â˜… ${rating}</span>` : ''}
              ${tt.has_cart ? '<span class="badge">Cart</span>' : ''}
            </div>
          </div>
          <div class="price-block">
            <div class="price">${price}</div>
          </div>
          <div class="card-buttons">
            <a href="${bookingUrl}" target="_blank" class="book-btn" onclick="trackBookClick(${tt.course_id}, '${tt.course_name.replace(/'/g, "\\'")}')">Book</a>
            ${phoneNumber ? `<a href="tel:${phoneNumber}" class="call-btn" onclick="trackCallClick(${tt.course_id}, '${tt.course_name.replace(/'/g, "\\'")}')">Call</a>` : ''}
          </div>
        </div>
      `;
    }

    async function openCourseDetail(courseId) {
      currentCourseId = courseId;
      const modal = document.getElementById('course-modal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      document.getElementById('modal-body').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

      // Update favorite button state
      const favBtn = document.getElementById('modal-fav-btn');
      favBtn.classList.toggle('favorited', isFavorite(courseId));

      try {
        // Fetch booking info (course data from Golf Course API + 2-day tee times)
        const res = await fetch(`${API_BASE}/courses/${courseId}/booking-info?_t=${Date.now()}`);
        const data = await res.json();
        renderBookingPopup(data);
      } catch (e) {
        console.error('Error loading course:', e);
        document.getElementById('modal-body').innerHTML = '<p>Error loading course details.</p>';
      }
    }

    function renderBookingPopup(data) {
      const { course, teeTimes, dates } = data;
      const heroImg = course.photo_url || `https://picsum.photos/seed/${course.id}/800/400`;

      document.getElementById('modal-hero-img').src = heroImg;
      document.getElementById('modal-course-name').textContent = course.name;
      document.getElementById('modal-course-location').textContent = `${course.city}, ${course.region} â€¢ ${course.holes} holes`;

      // Build external course info section from Golf Course API
      let externalInfoHtml = '';
      if (course.external) {
        const ext = course.external;
        externalInfoHtml = `
          <div class="modal-section">
            <h3>Course Info</h3>
            <div class="external-course-info">
              ${ext.address ? `<div class="info-row"><span class="label">Address:</span> ${ext.address}</div>` : ''}
              ${ext.phone ? `<div class="info-row"><span class="label">Phone:</span> <a href="tel:${ext.phone.replace(/[^0-9]/g, '')}">${ext.phone}</a></div>` : ''}
              ${ext.website ? `<div class="info-row"><span class="label">Website:</span> <a href="${ext.website}" target="_blank">Visit Site</a></div>` : ''}
              ${ext.holes ? `<div class="info-row"><span class="label">Holes:</span> ${ext.holes}</div>` : ''}
              ${ext.par ? `<div class="info-row"><span class="label">Par:</span> ${ext.par}</div>` : ''}
              ${ext.yardage ? `<div class="info-row"><span class="label">Yardage:</span> ${ext.yardage?.toLocaleString()}</div>` : ''}
              ${ext.slope_rating || ext.slope ? `<div class="info-row"><span class="label">Slope:</span> ${ext.slope_rating || ext.slope}</div>` : ''}
              ${ext.course_rating || ext.rating ? `<div class="info-row"><span class="label">Rating:</span> ${ext.course_rating || ext.rating}</div>` : ''}
              ${ext.green_grass ? `<div class="info-row"><span class="label">Greens:</span> ${ext.green_grass}</div>` : ''}
              ${ext.fairway_grass ? `<div class="info-row"><span class="label">Fairways:</span> ${ext.fairway_grass}</div>` : ''}
            </div>
          </div>
        `;
      } else {
        // Fallback to our database info
        externalInfoHtml = `
          <div class="modal-section">
            <h3>Course Info</h3>
            <div class="external-course-info">
              ${course.phone_number ? `<div class="info-row"><span class="label">Phone:</span> <a href="tel:${course.phone_number.replace(/[^0-9]/g, '')}">${course.phone_number}</a></div>` : ''}
              ${course.website_url ? `<div class="info-row"><span class="label">Website:</span> <a href="${course.website_url}" target="_blank">Visit Site</a></div>` : ''}
              ${course.par ? `<div class="info-row"><span class="label">Par:</span> ${course.par}</div>` : ''}
              ${course.yardage ? `<div class="info-row"><span class="label">Yardage:</span> ${course.yardage?.toLocaleString()}</div>` : ''}
              ${course.slope_rating ? `<div class="info-row"><span class="label">Slope:</span> ${course.slope_rating}</div>` : ''}
              ${course.course_rating ? `<div class="info-row"><span class="label">Rating:</span> ${course.course_rating}</div>` : ''}
            </div>
          </div>
        `;
      }

      // Group tee times by date
      const teeTimesByDate = {};
      teeTimes.forEach(tt => {
        if (!teeTimesByDate[tt.date]) {
          teeTimesByDate[tt.date] = [];
        }
        teeTimesByDate[tt.date].push(tt);
      });

      // Format date for display
      const formatDateLabel = (dateStr) => {
        const date = new Date(dateStr + 'T00:00:00');
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        if (date.getTime() === today.getTime()) return 'Today';
        if (date.getTime() === tomorrow.getTime()) return 'Tomorrow';
        return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
      };

      // Build booking action buttons (always show these prominently)
      const phoneNumber = course.external?.phone || course.phone_number;
      const bookingUrl = course.booking_url;

      let bookingActionsHtml = `
        <div class="modal-section booking-actions">
          <div class="booking-buttons">
            ${bookingUrl ? `
              <a href="${bookingUrl}" target="_blank" rel="noopener" class="btn btn-action">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                Book Online
              </a>
            ` : ''}
            ${phoneNumber ? `
              <a href="tel:${phoneNumber.replace(/[^0-9]/g, '')}" class="btn btn-action">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                Call to Book
              </a>
            ` : ''}
          </div>
        </div>
      `;

      // Build tee times section
      let teeTimesHtml = '';

      if (Object.keys(teeTimesByDate).length > 0) {
        teeTimesHtml = '<div class="modal-section"><h3>Available Tee Times</h3>';
        Object.keys(teeTimesByDate).sort().forEach(dateStr => {
          const dayTeeTimes = teeTimesByDate[dateStr];
          teeTimesHtml += `
            <div class="booking-date-group">
              <h4>${formatDateLabel(dateStr)}</h4>
              <div class="booking-times-grid">
                ${dayTeeTimes.map(tt => `
                  <a href="${tt.booking_url || bookingUrl}" target="_blank" rel="noopener" class="booking-time-slot">
                    <span class="time">${formatTime(tt.time)}</span>
                    <span class="price">$${tt.price}</span>
                    <span class="details">${tt.holes === 9 ? '9H â€¢ ' : ''}${tt.has_cart ? 'Cart included' : ''}</span>
                  </a>
                `).join('')}
              </div>
            </div>
          `;
        });
        teeTimesHtml += '</div>';
      }

      // Link to full course page
      const coursePageLink = `
        <div class="modal-section" style="text-align: center; padding-top: 0;">
          <a href="/course/${course.slug || course.id}" class="btn btn-secondary" style="display: inline-block;">View on Map</a>
        </div>
      `;

      document.getElementById('modal-body').innerHTML = bookingActionsHtml + externalInfoHtml + teeTimesHtml + coursePageLink;
    }

    function renderCourseDetail(course) {
      const heroImg = course.photos?.[0]?.url || course.photo_url || `https://picsum.photos/seed/${course.id}/800/400`;
      document.getElementById('modal-hero-img').src = heroImg;
      document.getElementById('modal-course-name').textContent = course.name;
      document.getElementById('modal-course-location').textContent = `${course.city}, ${course.region} â€¢ ${course.holes} holes`;

      const recentAvg = course.recent_avg_rating?.toFixed(1) || 'N/A';
      const allTimeAvg = course.avg_rating?.toFixed(1) || 'N/A';
      const ratingDiff = course.recent_avg_rating && course.avg_rating ? (course.recent_avg_rating - course.avg_rating).toFixed(1) : null;
      const ratingTrend = ratingDiff ? (ratingDiff > 0 ? `<span class="up">â†‘ ${ratingDiff} higher</span>` : ratingDiff < 0 ? `<span class="down">â†“ ${Math.abs(ratingDiff)} lower</span>` : 'Same') : '';

      // Weather Underground URL using lat/lng
      const weatherUrl = course.latitude && course.longitude
        ? `https://www.wunderground.com/hourly/us/ca/${course.city.toLowerCase().replace(/\s+/g, '-')}/${course.latitude},${course.longitude}`
        : `https://www.wunderground.com/weather/us/ca/${course.city.toLowerCase().replace(/\s+/g, '-')}`;

      let html = `
        <div class="modal-section">
          <h3>ðŸ“ž Contact & Info</h3>
          <div class="contact-info">
            ${course.phone_number ? `
              <a href="tel:${course.phone_number.replace(/[^0-9]/g, '')}" class="contact-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                <div><div class="label">Clubhouse</div><div class="value">${course.phone_number}</div></div>
              </a>
            ` : ''}
            ${course.website_url ? `
              <a href="${course.website_url}" target="_blank" class="contact-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="2" y1="12" x2="22" y2="12"></line>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                </svg>
                <div><div class="label">Website</div><div class="value">Visit Course Site</div></div>
              </a>
            ` : ''}
          </div>
        </div>

        <div class="modal-section">
          <h3>ðŸŒ¤ï¸ Weather</h3>
          <a href="${weatherUrl}" target="_blank" class="weather-link">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 18a5 5 0 0 0-2.18-9.43A8 8 0 1 0 3 16.29"></path>
              <circle cx="12" cy="12" r="3"></circle>
              <line x1="12" y1="5" x2="12" y2="3"></line>
              <line x1="17" y1="7" x2="18.4" y2="5.6"></line>
              <line x1="19" y1="12" x2="21" y2="12"></line>
            </svg>
            <div class="weather-text">
              <strong>View Hourly Forecast</strong>
              <span>Weather Underground - ${course.city}</span>
            </div>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
          </a>
        </div>

        <div class="modal-section">
          <h3>â›³ Practice Facilities</h3>
          <div class="facilities-grid">
            <div class="facility-badge ${course.has_driving_range ? 'available' : 'unavailable'}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                ${course.has_driving_range ? '<polyline points="20 6 9 17 4 12"></polyline>' : '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'}
              </svg>
              Driving Range
            </div>
            <div class="facility-badge ${course.has_practice_green ? 'available' : 'unavailable'}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                ${course.has_practice_green ? '<polyline points="20 6 9 17 4 12"></polyline>' : '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'}
              </svg>
              Practice Green
            </div>
            <div class="facility-badge ${course.has_pro_shop ? 'available' : 'unavailable'}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                ${course.has_pro_shop ? '<polyline points="20 6 9 17 4 12"></polyline>' : '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>'}
              </svg>
              Pro Shop
            </div>
          </div>
        </div>

        <div class="modal-section">
          <h3>ðŸ“Š Course Stats</h3>
          <div class="course-stats">
            <div class="course-stat"><div class="value">${course.par || '-'}</div><div class="label">Par</div></div>
            <div class="course-stat"><div class="value">${course.yardage?.toLocaleString() || '-'}</div><div class="label">Yards</div></div>
            <div class="course-stat"><div class="value">${course.slope_rating || '-'}</div><div class="label">Slope</div></div>
            <div class="course-stat"><div class="value">${course.course_rating || '-'}</div><div class="label">Rating</div></div>
            <div class="course-stat"><div class="value">${course.upcoming_tee_times}</div><div class="label">Available</div></div>
          </div>
        </div>
      `;

      if (course.course_record_score) {
        html += `
          <div class="modal-section">
            <h3>ðŸ† Course Record</h3>
            <div class="course-record">
              <div class="score">${course.course_record_score}</div>
              <div class="holder">${course.course_record_holder} (${course.course_record_date})</div>
              <div class="details">${course.course_record_details || ''}</div>
            </div>
          </div>
        `;
      }

      if (course.tournament_history?.length > 0) {
        html += `
          <div class="modal-section">
            <h3>ðŸŒï¸ PGA Tour History</h3>
            <div class="tournament-history">
              ${course.tournament_history.map(t => `
                <div class="tournament-item">
                  <div class="tournament-header">
                    <span class="tournament-name">${t.tournament_name}</span>
                    <span class="tournament-year">${t.year}</span>
                  </div>
                  <div class="tournament-winner">
                    <span class="winner-name">${t.winner_name}</span>
                    <span class="winner-score">${t.score_to_par !== 'N/A' && t.score_to_par !== 'Match Play' ? t.score_to_par : t.winning_score}</span>
                  </div>
                  ${t.notes ? `<div class="tournament-notes">${t.notes}</div>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (course.reviews?.length > 0) {
        html += `
          <div class="modal-section">
            <h3>â­ Reviews</h3>
            <div class="rating-comparison">
              <div class="rating-box"><div class="value">${recentAvg}</div><div class="label">Recent (10)</div></div>
              <div class="rating-box"><div class="value">${allTimeAvg}</div><div class="label">All Time</div></div>
              <div class="rating-trend">Recent reviews are ${ratingTrend} than all-time average</div>
            </div>
            <div class="reviews-list" style="margin-top: 16px;">
              ${course.reviews.slice(0, 5).map(r => `
                <div class="review-card">
                  <div class="review-header">
                    <span class="review-author">${r.author_name}</span>
                    <span class="review-rating">${'â˜…'.repeat(r.rating)}${'â˜†'.repeat(5-r.rating)}</span>
                  </div>
                  <div class="review-text">${r.text}</div>
                  <div class="review-time">${r.relative_time}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (course.photos?.length > 0) {
        html += `
          <div class="modal-section">
            <h3>ðŸ“· Photos</h3>
            <div class="photos-grid">
              ${course.photos.map(p => `
                <div class="photo-card">
                  <img src="${p.url}" alt="${p.caption || 'Course photo'}">
                  ${p.year_taken ? `<span class="year">${p.year_taken}</span>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (course.top_food) {
        html += `
          <div class="modal-section">
            <h3>ðŸ” Top-Rated Clubhouse Food</h3>
            <div class="food-highlight">
              <img src="${course.top_food.photo_url}" alt="${course.top_food.name}">
              <div class="food-info">
                <h4>${course.top_food.name}</h4>
                <p>${course.top_food.description}</p>
                <div class="food-rating">â˜… ${course.top_food.avg_rating?.toFixed(1)} (${course.top_food.mention_count} mentions)</div>
              </div>
            </div>
          </div>
        `;
      }

      if (course.website_url) {
        html += `
          <div class="modal-section" style="text-align: center;">
            <a href="${course.website_url}" target="_blank" class="btn" style="display: inline-block;">Visit Course Website</a>
          </div>
        `;
      }

      document.getElementById('modal-body').innerHTML = html;
    }

    function closeModal() {
      document.getElementById('course-modal').classList.remove('active');
      document.body.style.overflow = '';
    }

    function closeModalOnOverlay(e) {
      if (e.target.id === 'course-modal') closeModal();
    }

    function formatTime(t) {
      if (!t) return '';
      if (t.includes('AM') || t.includes('PM')) return t;
      const [h, m] = t.split(':');
      const hr = parseInt(h);
      return `${hr % 12 || 12}:${m} ${hr >= 12 ? 'PM' : 'AM'}`;
    }

    function formatDate(d) {
      if (!d) return '';
      const date = new Date(d + 'T00:00:00');
      return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    }

    document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeModal(); closeCompareModal(); } });

    // ========== COMPARE COURSES FUNCTIONALITY ==========
    let compareData = null; // Store comparison data for filtering

    async function openCompareModal() {
      const modal = document.getElementById('compare-modal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';

      // Populate course dropdowns
      const select1 = document.getElementById('compare-course-1');
      const select2 = document.getElementById('compare-course-2');

      // Fetch all courses if not already loaded
      if (!coursesData.length) {
        try {
          const res = await fetch(`${API_BASE}/courses?all=true`);
          coursesData = await res.json();
        } catch (e) {
          console.error('Error loading courses:', e);
        }
      }

      // Clear and populate selects
      select1.innerHTML = '<option value="">Select first course...</option>';
      select2.innerHTML = '<option value="">Select second course...</option>';

      coursesData.sort((a, b) => a.name.localeCompare(b.name)).forEach(c => {
        select1.innerHTML += `<option value="${c.id}">${c.name} (${c.city})</option>`;
        select2.innerHTML += `<option value="${c.id}">${c.name} (${c.city})</option>`;
      });
    }

    function closeCompareModal() {
      document.getElementById('compare-modal').classList.remove('active');
      document.body.style.overflow = '';
      compareData = null;
    }

    function closeCompareModalOnOverlay(e) {
      if (e.target.id === 'compare-modal') closeCompareModal();
    }

    async function updateComparison() {
      const course1Id = document.getElementById('compare-course-1').value;
      const course2Id = document.getElementById('compare-course-2').value;
      const body = document.getElementById('compare-body');
      const filters = document.getElementById('compare-filters');

      if (!course1Id || !course2Id) {
        body.innerHTML = '<p class="compare-placeholder">Select two courses above to compare</p>';
        filters.style.display = 'none';
        return;
      }

      if (course1Id === course2Id) {
        body.innerHTML = '<p class="compare-placeholder">Please select two different courses</p>';
        filters.style.display = 'none';
        return;
      }

      body.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

      try {
        const res = await fetch(`${API_BASE}/courses/compare?course1=${course1Id}&course2=${course2Id}`);
        compareData = await res.json();

        // Populate date filter
        const allDates = [...new Set([
          ...compareData.course1.teeTimes.map(t => t.date),
          ...compareData.course2.teeTimes.map(t => t.date)
        ])].sort();

        const dateFilter = document.getElementById('compare-date-filter');
        dateFilter.innerHTML = '<option value="">All Days</option>';
        allDates.forEach(d => {
          dateFilter.innerHTML += `<option value="${d}">${formatDate(d)}</option>`;
        });

        filters.style.display = 'flex';
        renderComparison(compareData);
      } catch (e) {
        console.error('Error loading comparison:', e);
        body.innerHTML = '<p class="compare-placeholder">Error loading comparison data</p>';
        filters.style.display = 'none';
      }
    }

    function filterCompareTeeTimes() {
      if (!compareData) return;

      const dateFilter = document.getElementById('compare-date-filter').value;
      const timeFilter = document.getElementById('compare-time-filter').value;
      const priceFilter = document.getElementById('compare-price-filter').value;

      const filterTimes = (times) => {
        return times.filter(tt => {
          if (dateFilter && tt.date !== dateFilter) return false;
          if (priceFilter && tt.price > parseInt(priceFilter)) return false;
          if (timeFilter) {
            const hour = parseInt(tt.time.split(':')[0]);
            if (timeFilter === 'morning' && hour >= 10) return false;
            if (timeFilter === 'midday' && (hour < 10 || hour >= 14)) return false;
            if (timeFilter === 'afternoon' && hour < 14) return false;
          }
          return true;
        });
      };

      const filteredData = {
        course1: { ...compareData.course1, teeTimes: filterTimes(compareData.course1.teeTimes) },
        course2: { ...compareData.course2, teeTimes: filterTimes(compareData.course2.teeTimes) }
      };

      renderComparison(filteredData, true);
    }

    function renderComparison(data, isFiltered = false) {
      const { course1, course2 } = data;

      // Helper to highlight better value - returns class for the better one
      const better = (v1, v2, lowerIsBetter = false) => {
        if (v1 === null || v1 === undefined || v2 === null || v2 === undefined) return ['', ''];
        if (v1 === v2) return ['', ''];
        if (lowerIsBetter) {
          return v1 < v2 ? ['better', ''] : ['', 'better'];
        }
        return v1 > v2 ? ['better', ''] : ['', 'better'];
      };

      const parClasses = better(course1.par, course2.par);
      const yardClasses = better(course1.yardage, course2.yardage);
      const slopeClasses = better(course1.slope_rating, course2.slope_rating);
      const courseRatingClasses = better(course1.course_rating, course2.course_rating);
      const ratingClasses = better(course1.avg_rating, course2.avg_rating);
      const avgPriceClasses = better(course1.priceStats?.avg, course2.priceStats?.avg, true);
      const minPriceClasses = better(course1.priceStats?.min, course2.priceStats?.min, true);
      const maxPriceClasses = better(course1.priceStats?.max, course2.priceStats?.max, true);
      const availClasses = better(course1.teeTimes?.length || 0, course2.teeTimes?.length || 0);

      // Format weather link
      const weatherLink = (c) => c.latitude && c.longitude
        ? `https://www.wunderground.com/hourly/us/ca/${c.city.toLowerCase().replace(/\s+/g, '-')}/${c.latitude},${c.longitude}`
        : `https://www.wunderground.com/weather/us/ca/${c.city.toLowerCase().replace(/\s+/g, '-')}`;

      // Format tee times list with booking links
      const formatTeeTimes = (times, bookingUrl) => {
        if (!times || !times.length) return '<p style="color: var(--text-muted); font-style: italic; text-align: center;">No times available</p>';
        return times.slice(0, 8).map(tt => `
          <div class="compare-tee-time">
            <a href="${tt.booking_url || bookingUrl}" target="_blank">${formatDate(tt.date)} ${formatTime(tt.time)}</a>
            <span>$${tt.price}</span>
          </div>
        `).join('') + (times.length > 8 ? `<p style="font-size: 0.8rem; color: var(--text-muted); text-align: center;">+${times.length - 8} more</p>` : '');
      };

      const html = `
        <div class="compare-grid">
          <!-- Course Names -->
          <div class="compare-names-row">
            <div class="compare-column left">
              <div class="compare-course-name">${course1.name}</div>
              <div class="compare-course-location">${course1.city}</div>
            </div>
            <div class="compare-column center"><div class="compare-label">VS</div></div>
            <div class="compare-column right">
              <div class="compare-course-name">${course2.name}</div>
              <div class="compare-course-location">${course2.city}</div>
            </div>
          </div>

          <!-- Course Stats Section -->
          <div class="compare-section-title">Course Stats</div>

          <div class="compare-stat-row">
            <div class="compare-value ${parClasses[0]}">${course1.par || '-'}</div>
            <div class="compare-label">Par</div>
            <div class="compare-value ${parClasses[1]}">${course2.par || '-'}</div>
          </div>

          <div class="compare-stat-row">
            <div class="compare-value ${yardClasses[0]}">${course1.yardage?.toLocaleString() || '-'}</div>
            <div class="compare-label">Yards</div>
            <div class="compare-value ${yardClasses[1]}">${course2.yardage?.toLocaleString() || '-'}</div>
          </div>

          <div class="compare-stat-row">
            <div class="compare-value ${slopeClasses[0]}">${course1.slope_rating || '-'}</div>
            <div class="compare-label">Slope</div>
            <div class="compare-value ${slopeClasses[1]}">${course2.slope_rating || '-'}</div>
          </div>

          <div class="compare-stat-row">
            <div class="compare-value ${courseRatingClasses[0]}">${course1.course_rating || '-'}</div>
            <div class="compare-label">Rating</div>
            <div class="compare-value ${courseRatingClasses[1]}">${course2.course_rating || '-'}</div>
          </div>

          <!-- Rating Section -->
          <div class="compare-section-title">User Rating</div>

          <div class="compare-stat-row">
            <div class="compare-value ${ratingClasses[0]}">${course1.avg_rating?.toFixed(1) || '-'} â˜…</div>
            <div class="compare-label">Avg Stars</div>
            <div class="compare-value ${ratingClasses[1]}">${course2.avg_rating?.toFixed(1) || '-'} â˜…</div>
          </div>

          <!-- Pricing Section -->
          <div class="compare-section-title">Pricing</div>

          <div class="compare-stat-row">
            <div class="compare-value ${avgPriceClasses[0]}">${course1.priceStats?.avg ? '$' + course1.priceStats.avg : '-'}</div>
            <div class="compare-label">Avg Price</div>
            <div class="compare-value ${avgPriceClasses[1]}">${course2.priceStats?.avg ? '$' + course2.priceStats.avg : '-'}</div>
          </div>

          <div class="compare-stat-row">
            <div class="compare-value ${minPriceClasses[0]}">${course1.priceStats?.min ? '$' + course1.priceStats.min : '-'}</div>
            <div class="compare-label">Min Price</div>
            <div class="compare-value ${minPriceClasses[1]}">${course2.priceStats?.min ? '$' + course2.priceStats.min : '-'}</div>
          </div>

          <div class="compare-stat-row">
            <div class="compare-value ${maxPriceClasses[0]}">${course1.priceStats?.max ? '$' + course1.priceStats.max : '-'}</div>
            <div class="compare-label">Max Price</div>
            <div class="compare-value ${maxPriceClasses[1]}">${course2.priceStats?.max ? '$' + course2.priceStats.max : '-'}</div>
          </div>

          <!-- Weather Section -->
          <div class="compare-section-title">Weather</div>

          <div class="compare-stat-row">
            <div class="compare-value"><a href="${weatherLink(course1)}" target="_blank" style="color: var(--primary);">View</a></div>
            <div class="compare-label">Forecast</div>
            <div class="compare-value"><a href="${weatherLink(course2)}" target="_blank" style="color: var(--primary);">View</a></div>
          </div>

          <!-- Availability Section -->
          <div class="compare-section-title">Availability${isFiltered ? ' (Filtered)' : ''}</div>

          <div class="compare-stat-row">
            <div class="compare-value ${availClasses[0]}">${course1.teeTimes?.length || 0}</div>
            <div class="compare-label">Tee Times</div>
            <div class="compare-value ${availClasses[1]}">${course2.teeTimes?.length || 0}</div>
          </div>

          <!-- Upcoming Tee Times -->
          <div class="compare-section-title">Upcoming Times</div>

          <div class="compare-tee-times-row">
            <div class="compare-column left compare-tee-times">${formatTeeTimes(course1.teeTimes, course1.booking_url)}</div>
            <div class="compare-column center"></div>
            <div class="compare-column right compare-tee-times">${formatTeeTimes(course2.teeTimes, course2.booking_url)}</div>
          </div>
        </div>

        <div class="compare-actions">
          <a href="/course/${course1.slug || course1.id}" class="btn btn-secondary">View ${course1.name.split(' ').slice(0,2).join(' ')}</a>
          <a href="/course/${course2.slug || course2.id}" class="btn btn-secondary">View ${course2.name.split(' ').slice(0,2).join(' ')}</a>
        </div>
      `;

      document.getElementById('compare-body').innerHTML = html;
    }

    // Track call button clicks
    function trackCallClick(courseId, courseName) {
      if (window.BayAreaGolfAnalytics) {
        window.BayAreaGolfAnalytics.trackBookingClick(courseId, courseName, null);
      }
      // Track as call_initiated event
      fetch('/api/analytics/event', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          event_type: 'call_initiated',
          event_data: { course_name: courseName },
          page_url: window.location.pathname,
          course_id: courseId
        })
      }).catch(() => {});
    }

    function trackBookClick(courseId, courseName) {
      if (window.BayAreaGolfAnalytics) {
        window.BayAreaGolfAnalytics.trackBookingClick(courseId, courseName, null);
      }
      // Track as book_clicked event
      fetch('/api/analytics/event', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          event_type: 'book_clicked',
          event_data: { course_name: courseName },
          page_url: window.location.pathname,
          course_id: courseId
        })
      }).catch(() => {});
    }

    // Register Service Worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('SW registered'))
          .catch(err => console.log('SW registration failed:', err));
      });
    }
  </script>

  <!-- AI Golf Concierge Chat Widget -->
  <style>
    /* Chat Widget Styles - Scoped with .golf-chat prefix */
    .golf-chat-fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(45, 90, 39, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 9998;
    }
    .golf-chat-fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 28px rgba(45, 90, 39, 0.5);
    }
    .golf-chat-fab svg {
      width: 28px;
      height: 28px;
      fill: white;
    }
    .golf-chat-fab-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: var(--deal);
      color: white;
      font-size: 10px;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 10px;
      font-family: system-ui, sans-serif;
    }

    .golf-chat-modal {
      display: none;
      position: fixed;
      bottom: 100px;
      right: 24px;
      width: 400px;
      max-width: calc(100vw - 48px);
      height: 550px;
      max-height: calc(100vh - 140px);
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(61, 41, 20, 0.25);
      z-index: 9999;
      flex-direction: column;
      overflow: hidden;
      border: 2px solid var(--border-light);
    }
    .golf-chat-modal.active {
      display: flex;
      animation: chatSlideIn 0.3s ease;
    }
    @keyframes chatSlideIn {
      from { opacity: 0; transform: translateY(20px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .golf-chat-header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #f4f1e8;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .golf-chat-header h3 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.1rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .golf-chat-header h3 svg {
      width: 20px;
      height: 20px;
    }
    .golf-chat-close {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    .golf-chat-close:hover {
      background: rgba(255,255,255,0.3);
    }

    .golf-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .golf-chat-message {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 0.95rem;
      line-height: 1.5;
    }
    .golf-chat-message.bot {
      background: white;
      border: 1px solid var(--border-light);
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    .golf-chat-message.user {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .golf-chat-suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .golf-chat-suggestion {
      background: var(--bg);
      border: 1px solid var(--border-light);
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text);
    }
    .golf-chat-suggestion:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .golf-chat-result {
      background: white;
      border: 2px solid var(--border-light);
      border-radius: 12px;
      padding: 14px;
      margin-top: 8px;
    }
    .golf-chat-result-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }
    .golf-chat-result-course {
      font-family: 'Playfair Display', Georgia, serif;
      font-weight: 600;
      font-size: 1rem;
      color: var(--primary-dark);
    }
    .golf-chat-result-price {
      font-weight: bold;
      color: var(--success);
      font-size: 1.1rem;
    }
    .golf-chat-result-details {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }
    .golf-chat-result-reasons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }
    .golf-chat-result-reason {
      background: #e8f5e9;
      color: var(--primary-dark);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
    }
    .golf-chat-result-book {
      display: inline-block;
      background: var(--primary);
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background 0.2s;
    }
    .golf-chat-result-book:hover {
      background: var(--primary-dark);
    }

    .golf-chat-input-area {
      padding: 12px 16px;
      border-top: 1px solid var(--border-light);
      background: var(--bg-paper);
    }
    .golf-chat-input-wrapper {
      display: flex;
      gap: 10px;
    }
    .golf-chat-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid var(--border-light);
      border-radius: 24px;
      font-size: 0.95rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
    }
    .golf-chat-input:focus {
      border-color: var(--primary);
    }
    .golf-chat-send {
      background: var(--primary);
      color: white;
      border: none;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .golf-chat-send:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }
    .golf-chat-send:disabled {
      background: var(--border);
      cursor: not-allowed;
      transform: none;
    }
    .golf-chat-send svg {
      width: 20px;
      height: 20px;
    }

    .golf-chat-typing {
      display: flex;
      gap: 4px;
      padding: 12px 16px;
      align-self: flex-start;
    }
    .golf-chat-typing span {
      width: 8px;
      height: 8px;
      background: var(--border);
      border-radius: 50%;
      animation: typingDot 1.4s infinite;
    }
    .golf-chat-typing span:nth-child(2) { animation-delay: 0.2s; }
    .golf-chat-typing span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typingDot {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
      30% { transform: translateY(-6px); opacity: 1; }
    }

    @media (max-width: 500px) {
      .golf-chat-modal {
        bottom: 0;
        right: 0;
        left: 0;
        width: 100%;
        max-width: 100%;
        height: 85vh;
        max-height: 85vh;
        border-radius: 16px 16px 0 0;
      }
      .golf-chat-fab {
        bottom: 16px;
        right: 16px;
      }
    }
  </style>

  <!-- Chat FAB Button -->
  <button class="golf-chat-fab" onclick="toggleGolfChat()" aria-label="Open AI Golf Concierge">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
    </svg>
    <span class="golf-chat-fab-badge">AI</span>
  </button>

  <!-- Chat Modal -->
  <div class="golf-chat-modal" id="golf-chat-modal">
    <div class="golf-chat-header">
      <h3>
        <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/><path fill="white" d="M12 6a3 3 0 0 0-3 3c0 1.5 1 2.5 2 3.5l1 1 1-1c1-1 2-2 2-3.5a3 3 0 0 0-3-3z"/></svg>
        Golf Concierge
      </h3>
      <button class="golf-chat-close" onclick="toggleGolfChat()" aria-label="Close chat">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="golf-chat-messages" id="golf-chat-messages">
      <!-- Messages will be inserted here -->
    </div>
    <div class="golf-chat-input-area">
      <div class="golf-chat-input-wrapper">
        <input type="text" class="golf-chat-input" id="golf-chat-input" placeholder="Try: 'Under $60 this weekend'" onkeypress="handleChatKeypress(event)">
        <button class="golf-chat-send" id="golf-chat-send" onclick="sendChatMessage()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Golf Chat Widget - Self-contained
    (function() {
      const chatState = {
        isOpen: false,
        sessionId: 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
        isLoading: false
      };

      const exampleQueries = [
        "Under $60 this weekend",
        "Morning tee time tomorrow",
        "Best deals in East Bay",
        "Twilight rates today"
      ];

      // Initialize chat with welcome message
      window.initGolfChat = function() {
        const messages = document.getElementById('golf-chat-messages');
        if (!messages.hasChildNodes()) {
          addBotMessage("Hi! I'm your golf concierge. Tell me what you're looking for and I'll find the perfect tee time.", exampleQueries);
        }
      };

      window.toggleGolfChat = function() {
        const modal = document.getElementById('golf-chat-modal');
        chatState.isOpen = !chatState.isOpen;
        modal.classList.toggle('active', chatState.isOpen);
        if (chatState.isOpen) {
          initGolfChat();
          document.getElementById('golf-chat-input').focus();
        }
      };

      window.handleChatKeypress = function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendChatMessage();
        }
      };

      window.sendChatMessage = async function(overrideMessage) {
        const input = document.getElementById('golf-chat-input');
        const message = overrideMessage || input.value.trim();
        if (!message || chatState.isLoading) return;

        input.value = '';
        addUserMessage(message);
        showTypingIndicator();
        chatState.isLoading = true;
        document.getElementById('golf-chat-send').disabled = true;

        try {
          const response = await fetch('/api/agent/search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              query: message,
              sessionId: chatState.sessionId
            })
          });

          const data = await response.json();
          hideTypingIndicator();

          if (data.success && data.topPick) {
            addBotMessage(data.message);
            addResultCard(data.topPick);
            if (data.alternatives && data.alternatives.length > 0) {
              addBotMessage("Other options:", data.alternatives.map(a => `${a.courseName} - ${a.time12} - $${a.price}`));
            }
          } else if (data.success) {
            addBotMessage(data.message, exampleQueries);
          } else {
            addBotMessage(data.message || "Sorry, I couldn't find any matches. Try adjusting your criteria.", exampleQueries);
          }
        } catch (error) {
          console.error('Chat error:', error);
          hideTypingIndicator();
          addBotMessage("Sorry, something went wrong. Please try again.", exampleQueries);
        }

        chatState.isLoading = false;
        document.getElementById('golf-chat-send').disabled = false;
      };

      function addUserMessage(text) {
        const messages = document.getElementById('golf-chat-messages');
        const div = document.createElement('div');
        div.className = 'golf-chat-message user';
        div.textContent = text;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      function addBotMessage(text, suggestions) {
        const messages = document.getElementById('golf-chat-messages');
        const div = document.createElement('div');
        div.className = 'golf-chat-message bot';
        div.innerHTML = text.replace(/\n/g, '<br>');

        if (suggestions && suggestions.length > 0) {
          const suggestionsDiv = document.createElement('div');
          suggestionsDiv.className = 'golf-chat-suggestions';
          suggestions.forEach(s => {
            const btn = document.createElement('button');
            btn.className = 'golf-chat-suggestion';
            btn.textContent = s;
            btn.onclick = () => sendChatMessage(s);
            suggestionsDiv.appendChild(btn);
          });
          div.appendChild(suggestionsDiv);
        }

        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      function addResultCard(result) {
        const messages = document.getElementById('golf-chat-messages');
        const div = document.createElement('div');
        div.className = 'golf-chat-result';
        div.innerHTML = `
          <div class="golf-chat-result-header">
            <div class="golf-chat-result-course">${result.courseName}</div>
            <div class="golf-chat-result-price">$${result.price}</div>
          </div>
          <div class="golf-chat-result-details">
            ${result.dayName} ${result.time12} Â· ${result.city || ''}
            ${result.rating ? `Â· ${result.rating}â˜…` : ''}
          </div>
          ${result.matchReasons && result.matchReasons.length > 0 ? `
            <div class="golf-chat-result-reasons">
              ${result.matchReasons.slice(0, 3).map(r => `<span class="golf-chat-result-reason">${r}</span>`).join('')}
            </div>
          ` : ''}
          <a href="${result.bookingUrl || '/course/' + result.courseSlug}" target="_blank" class="golf-chat-result-book">
            Book Now
          </a>
        `;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      function showTypingIndicator() {
        const messages = document.getElementById('golf-chat-messages');
        const existing = messages.querySelector('.golf-chat-typing');
        if (existing) return;

        const div = document.createElement('div');
        div.className = 'golf-chat-typing';
        div.innerHTML = '<span></span><span></span><span></span>';
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      function hideTypingIndicator() {
        const typing = document.querySelector('.golf-chat-typing');
        if (typing) typing.remove();
      }
    })();
  </script>

  <script src="/js/analytics.js"></script>
</body>
</html>
